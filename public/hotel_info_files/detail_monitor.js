/*!
 * jquery-powerFloat.js
 * jQuery 万能浮动层插件
 * http://www.zhangxinxu.com/wordpress/?p=1328
 * © by zhangxinxu  
 * 2010-12-06 v1.0.0 插件编写，初步调试
 * 2010-12-30 v1.0.1 限定尖角字符字体，避免受浏览器自定义字体干扰
 * 2011-01-03 v1.1.0 修复连续获得焦点显示后又隐藏的bug
       修复图片加载正则判断不准确的问题
 * 2011-02-15 v1.1.1 关于居中对齐位置判断的特殊处理
 * 2011-04-15 v1.2.0 修复浮动层含有过高select框在IE下点击会隐藏浮动层的问题，同时优化事件绑定   
 * 2011-09-13 v1.3.0  修复两个菜单hover时间间隔过短隐藏回调不执行的问题
 * 2012-01-13 v1.4.0 去除ajax加载的存储
                     修复之前按照ajax地址后缀判断是否图片的问题
      修复一些脚本运行出错
      修复hover延时显示时，元素没有显示但鼠标移出依然触发隐藏回调的问题
 * 2012-02-27 v1.5.0 为无id容器创建id逻辑使用错误的问题
       修复无事件浮动出现时同页面点击空白区域浮动层不隐藏的问题
      修复点击与hover并存时特定时候o.trigger报为null错误的问题
 * 2012-03-29 v1.5.1 修复连续hover时候后面一个不触发显示的问题
 * 2012-05-02 v1.5.2 点击事件 浮动框再次点击隐藏的问题修复
 * 2012-11-02 v1.6.0 兼容jQuery 1.8.2
 * 2012-01-28 v1.6.1 target参数支持funtion类型，以实现类似动态Ajax地址功能
 */
var defaults={width:"auto",offsets:{x:0,y:0},zIndex:1002,eventType:"hover",showDelay:0,hideDelay:0,hoverHold:true,hoverFollow:false,targetMode:"common",target:null,targetAttr:"rel",container:null,reverseSharp:false,position:"4-1",edgeAdjust:true,showCall:$.noop,hideCall:$.noop};$.fn.powerFloat=function(options){return $(this).each(function(){var s=$.extend({},defaults,options||{});var init=function(pms,trigger){if(o.target&&o.target.css("display")!=="none"){o.targetHide();}
o.s=pms;o.trigger=trigger;},hoverTimer;switch(s.eventType){case"hover":{$(this).hover(function(){if(o.timerHold){o.flagDisplay=true;}
var numShowDelay=parseInt(s.showDelay,10);init(s,$(this));if(numShowDelay){if(hoverTimer){clearTimeout(hoverTimer);}
hoverTimer=setTimeout(function(){o.targetGet.call(o);},numShowDelay);}else{o.targetGet();}},function(){if(hoverTimer){clearTimeout(hoverTimer);}
if(o.timerHold){clearTimeout(o.timerHold);}
o.flagDisplay=false;o.targetHold();});if(s.hoverFollow){$(this).mousemove(function(e){o.cacheData.left=e.pageX;o.cacheData.top=e.pageY;o.targetGet.call(o);return false;});}
break;}
case"click":{$(this).click(function(e){if(o.display&&o.trigger&&e.target===o.trigger.get(0)){o.flagDisplay=false;o.displayDetect();}else{init(s,$(this));o.targetGet();if(!$(document).data("mouseupBind")){$(document).bind("mouseup",function(e){var flag=false;if(o.trigger){var idTarget=o.target.attr("id");if(!idTarget){idTarget="R_"+Math.random();o.target.attr("id",idTarget);}
$(e.target).parents().each(function(){if($(this).attr("id")===idTarget){flag=true;}});if(s.eventType==="click"&&o.display&&e.target!=o.trigger.get(0)&&!flag){o.flagDisplay=false;o.displayDetect();}}
return false;}).data("mouseupBind",true);}}});break;}
case"focus":{$(this).focus(function(){var self=$(this);setTimeout(function(){init(s,self);o.targetGet();},200);}).blur(function(){o.flagDisplay=false;setTimeout(function(){o.displayDetect();},190);});break;}
default:{init(s,$(this));o.targetGet();$(document).unbind("mouseup").data("mouseupBind",false);}}});};var o={targetGet:function(){if(!this.trigger){return this;}
var attr=this.trigger.attr(this.s.targetAttr),target=typeof this.s.target=="function"?this.s.target.call(this.trigger):this.s.target;switch(this.s.targetMode){case"common":{if(target){var type=typeof(target);if(type==="object"){if(target.size()){o.target=target.eq(0);}}else if(type==="string"){if($(target).size()){o.target=$(target).eq(0);}}}else{if(attr&&$("#"+attr).size()){o.target=$("#"+attr);}}
if(o.target){o.targetShow();}else{return this;}
break;}
case"ajax":{var url=target||attr;this.targetProtect=false;if(!url){return;}
if(!o.cacheData[url]){o.loading();}
var tempImage=new Image();tempImage.onload=function(){var w=tempImage.width,h=tempImage.height;var winw=$(window).width(),winh=$(window).height();var imgScale=w/h,winScale=winw/winh;if(imgScale>winScale){if(w>winw/2){w=winw/2;h=w/imgScale;}}else{if(h>winh/2){h=winh/2;w=h*imgScale;}}
var imgHtml='<div class="ajax_image_con"><img class="float_ajax_image" src="'+url+'" width="'+w+'" height = "'+h+'" /></div>';o.cacheData[url]=true;o.target=$(imgHtml);o.targetShow();};tempImage.onerror=function(){if(/(\.jpg|\.png|\.gif|\.bmp|\.jpeg)$/i.test(url)){o.target=$('<div class="float_ajax_error">图片加载失败。</div>');o.targetShow();}else{$.ajax({url:url,success:function(data){if(typeof(data)==="string"){o.cacheData[url]=true;o.target=$('<div class="float_ajax_data">'+data+'</div>');o.targetShow();}},error:function(){o.target=$('<div class="float_ajax_error">数据没有加载成功。</div>');o.targetShow();}});}};tempImage.src=url;break;}
case"list":{var targetHtml='<ul class="float_list_ul">',arrLength;if($.isArray(target)&&(arrLength=target.length)){$.each(target,function(i,obj){var list="",strClass="",text,href;if(i===0){strClass=' class="float_list_li_first"';}
if(i===arrLength-1){strClass=' class="float_list_li_last"';}
if(typeof(obj)==="object"&&(text=obj.text.toString())){if(href=(obj.href||"javascript:")){list='<a href="'+href+'" class="float_list_a">'+text+'</a>';}else{list=text;}}else if(typeof(obj)==="string"&&obj){list=obj;}
if(list){targetHtml+='<li'+strClass+'>'+list+'</li>';}});}else{targetHtml+='<li class="float_list_null">列表无数据。</li>';}
targetHtml+='</ul>';o.target=$(targetHtml);this.targetProtect=false;o.targetShow();break;}
case"remind":{var strRemind=target||attr;this.targetProtect=false;if(typeof(strRemind)==="string"){o.target=$('<span>'+strRemind+'</span>');o.targetShow();}
break;}
default:{var objOther=target||attr,type=typeof(objOther);if(objOther){if(type==="string"){if(/^.[^:#\[\.,]*$/.test(objOther)){if($(objOther).size()){o.target=$(objOther).eq(0);this.targetProtect=true;}else if($("#"+objOther).size()){o.target=$("#"+objOther).eq(0);this.targetProtect=true;}else{o.target=$('<div>'+objOther+'</div>');this.targetProtect=false;}}else{o.target=$('<div>'+objOther+'</div>');this.targetProtect=false;}
o.targetShow();}else if(type==="object"){if(!$.isArray(objOther)&&objOther.size()){o.target=objOther.eq(0);this.targetProtect=true;o.targetShow();}}}}}
return this;},container:function(){var cont=this.s.container,mode=this.s.targetMode||"mode";if(mode==="ajax"||mode==="remind"){this.s.sharpAngle=true;}else{this.s.sharpAngle=false;}
if(this.s.reverseSharp){this.s.sharpAngle=!this.s.sharpAngle;}
if(mode!=="common"){if(cont===null){cont="plugin";}
if(cont==="plugin"){if(!$("#floatBox_"+mode).size()){$('<div id="floatBox_'+mode+'" class="float_'+mode+'_box"></div>').appendTo($("body")).hide();}
cont=$("#floatBox_"+mode);}
if(cont&&typeof(cont)!=="string"&&cont.size()){if(this.targetProtect){o.target.show().css("position","static");}
o.target=cont.empty().append(o.target);}}
return this;},setWidth:function(){var w=this.s.width;if(w==="auto"){if(this.target.get(0).style.width){this.target.css("width","auto");}}else if(w==="inherit"){this.target.width(this.trigger.width());}else{this.target.css("width",w);}
return this;},position:function(){if(!this.trigger||!this.target){return this;}
var pos,tri_h=0,tri_w=0,cor_w=0,cor_h=0,tri_l,tri_t,tar_l,tar_t,cor_l,cor_t,tar_h=this.target.data("height"),tar_w=this.target.data("width"),st=$(window).scrollTop(),off_x=parseInt(this.s.offsets.x,10)||0,off_y=parseInt(this.s.offsets.y,10)||0,mousePos=this.cacheData;if(!tar_h){tar_h=this.target.outerHeight();if(this.s.hoverFollow){this.target.data("height",tar_h);}}
if(!tar_w){tar_w=this.target.outerWidth();if(this.s.hoverFollow){this.target.data("width",tar_w);}}
pos=this.trigger.offset();tri_h=this.trigger.outerHeight();tri_w=this.trigger.outerWidth();tri_l=pos.left;tri_t=pos.top;var funMouseL=function(){if(tri_l<0){tri_l=0;}else if(tri_l+tri_h>$(window).width()){tri_l=$(window).width()-tri_w;}},funMouseT=function(){if(tri_t<0){tri_t=0;}else if(tri_t+tri_h>$(document).height()){tri_t=$(document).height()-tri_h;}};if(this.s.hoverFollow&&mousePos.left&&mousePos.top){if(this.s.hoverFollow==="x"){tri_l=mousePos.left
funMouseL();}else if(this.s.hoverFollow==="y"){tri_t=mousePos.top;funMouseT();}else{tri_l=mousePos.left;tri_t=mousePos.top;funMouseL();funMouseT();}}
var arrLegalPos=["4-1","1-4","5-7","2-3","2-1","6-8","3-4","4-3","8-6","1-2","7-5","3-2"],align=this.s.position,alignMatch=false,strDirect;$.each(arrLegalPos,function(i,n){if(n===align){alignMatch=true;return;}});if(!alignMatch){align="4-1";}
var funDirect=function(a){var dir="bottom";switch(a){case"1-4":case"5-7":case"2-3":{dir="top";break;}
case"2-1":case"6-8":case"3-4":{dir="right";break;}
case"1-2":case"8-6":case"4-3":{dir="left";break;}
case"4-1":case"7-5":case"3-2":{dir="bottom";break;}}
return dir;};var funCenterJudge=function(a){if(a==="5-7"||a==="6-8"||a==="8-6"||a==="7-5"){return true;}
return false;};var funJudge=function(dir){var totalHeight=0,totalWidth=0,flagCorner=(o.s.sharpAngle&&o.corner)?true:false;if(dir==="right"){totalWidth=tri_l+tri_w+tar_w+off_x;if(flagCorner){totalWidth+=o.corner.width();}
if(totalWidth>$(window).width()){return false;}}else if(dir==="bottom"){totalHeight=tri_t+tri_h+tar_h+off_y;if(flagCorner){totalHeight+=o.corner.height();}
if(totalHeight>st+$(window).height()){return false;}}else if(dir==="top"){totalHeight=tar_h+off_y;if(flagCorner){totalHeight+=o.corner.height();}
if(totalHeight>tri_t-st){return false;}}else if(dir==="left"){totalWidth=tar_w+off_x;if(flagCorner){totalWidth+=o.corner.width();}
if(totalWidth>tri_l){return false;}}
return true;};strDirect=funDirect(align);if(this.s.sharpAngle){this.createSharp(strDirect);}
if(this.s.edgeAdjust){if(funJudge(strDirect)){(function(){if(funCenterJudge(align)){return;}
var obj={top:{right:"2-3",left:"1-4"},right:{top:"2-1",bottom:"3-4"},bottom:{right:"3-2",left:"4-1"},left:{top:"1-2",bottom:"4-3"}};var o=obj[strDirect],name;if(o){for(name in o){if(!funJudge(name)){align=o[name];}}}})();}else{(function(){if(funCenterJudge(align)){var center={"5-7":"7-5","7-5":"5-7","6-8":"8-6","8-6":"6-8"};align=center[align];}else{var obj={top:{left:"3-2",right:"4-1"},right:{bottom:"1-2",top:"4-3"},bottom:{left:"2-3",right:"1-4"},left:{bottom:"2-1",top:"3-4"}};var o=obj[strDirect],arr=[];for(name in o){arr.push(name);}
if(funJudge(arr[0])||!funJudge(arr[1])){align=o[arr[0]];}else{align=o[arr[1]];}}})();}}
var strNewDirect=funDirect(align),strFirst=align.split("-")[0];if(this.s.sharpAngle){this.createSharp(strNewDirect);cor_w=this.corner.width(),cor_h=this.corner.height();}
if(this.s.hoverFollow){if(this.s.hoverFollow==="x"){tar_l=tri_l+off_x;if(strFirst==="1"||strFirst==="8"||strFirst==="4"){tar_l=tri_l-(tar_w-tri_w)/2+off_x;}else{tar_l=tri_l-(tar_w-tri_w)+off_x;}
if(strFirst==="1"||strFirst==="5"||strFirst==="2"){tar_t=tri_t-off_y-tar_h-cor_h;cor_t=tri_t-cor_h-off_y-1;}else{tar_t=tri_t+tri_h+off_y+cor_h;cor_t=tri_t+tri_h+off_y+1;}
cor_l=pos.left-(cor_w-tri_w)/2;}else if(this.s.hoverFollow==="y"){if(strFirst==="1"||strFirst==="5"||strFirst==="2"){tar_t=tri_t-(tar_h-tri_h)/2+off_y;}else{tar_t=tri_t-(tar_h-tri_h)+off_y;}
if(strFirst==="1"||strFirst==="8"||strFirst==="4"){tar_l=tri_l-tar_w-off_x-cor_w;cor_l=tri_l-cor_w-off_x-1;}else{tar_l=tri_l+tri_w-off_x+cor_w;cor_l=tri_l+tri_w+off_x+1;}
cor_t=pos.top-(cor_h-tri_h)/2;}else{tar_l=tri_l+off_x;tar_t=tri_t+off_y;}}else{switch(strNewDirect){case"top":{tar_t=tri_t-off_y-tar_h-cor_h;if(strFirst=="1"){tar_l=tri_l-off_x;}else if(strFirst==="5"){tar_l=tri_l-(tar_w-tri_w)/2-off_x;}else{tar_l=tri_l-(tar_w-tri_w)-off_x;}
cor_t=tri_t-cor_h-off_y-1;cor_l=tri_l-(cor_w-tri_w)/2;break;}
case"right":{tar_l=tri_l+tri_w+off_x+cor_w;if(strFirst=="2"){tar_t=tri_t+off_y;}else if(strFirst==="6"){tar_t=tri_t-(tar_h-tri_h)/2+off_y;}else{tar_t=tri_t-(tar_h-tri_h)+off_y;}
cor_l=tri_l+tri_w+off_x+1;cor_t=tri_t-(cor_h-tri_h)/2;break;}
case"bottom":{tar_t=tri_t+tri_h+off_y+cor_h;if(strFirst=="4"){tar_l=tri_l+off_x;}else if(strFirst==="7"){tar_l=tri_l-(tar_w-tri_w)/2+off_x;}else{tar_l=tri_l-(tar_w-tri_w)+off_x;}
cor_t=tri_t+tri_h+off_y+1;cor_l=tri_l-(cor_w-tri_w)/2;break;}
case"left":{tar_l=tri_l-tar_w-off_x-cor_w;if(strFirst=="2"){tar_t=tri_t-off_y;}else if(strFirst==="6"){tar_t=tri_t-(tar_w-tri_w)/2-off_y;}else{tar_t=tri_t-(tar_h-tri_h)-off_y;}
cor_l=tar_l+cor_w;cor_t=tri_t-(tar_w-cor_w)/2;break;}}}
if(cor_h&&cor_w&&this.corner){this.corner.css({left:cor_l,top:cor_t,zIndex:this.s.zIndex+1});}
this.target.css({position:"absolute",left:tar_l,top:tar_t,zIndex:this.s.zIndex});return this;},createSharp:function(dir){var bgColor,bdColor,color1="",color2="";var objReverse={left:"right",right:"left",bottom:"top",top:"bottom"},dirReverse=objReverse[dir]||"top";if(this.target){bgColor=this.target.css("background-color");if(parseInt(this.target.css("border-"+dirReverse+"-width"))>0){bdColor=this.target.css("border-"+dirReverse+"-color");}
if(bdColor&&bdColor!=="transparent"){color1='style="color:'+bdColor+';"';}else{color1='style="display:none;"';}
if(bgColor&&bgColor!=="transparent"){color2='style="color:'+bgColor+';"';}else{color2='style="display:none;"';}}
var html='<div id="floatCorner_'+dir+'" class="float_corner float_corner_'+dir+'">'+'<span class="corner corner_1" '+color1+'>◆</span>'+'<span class="corner corner_2" '+color2+'>◆</span>'+'</div>';if(!$("#floatCorner_"+dir).size()){$("body").append($(html));}
this.corner=$("#floatCorner_"+dir);return this;},targetHold:function(){if(this.s.hoverHold){var delay=parseInt(this.s.hideDelay,10)||200;if(this.target){this.target.hover(function(){o.flagDisplay=true;},function(){if(o.timerHold){clearTimeout(o.timerHold);}
o.flagDisplay=false;o.targetHold();});}
o.timerHold=setTimeout(function(){o.displayDetect.call(o);},delay);}else{this.displayDetect();}
return this;},loading:function(){this.target=$('<div class="float_loading"></div>');this.targetShow();this.target.removeData("width").removeData("height");return this;},displayDetect:function(){if(!this.flagDisplay&&this.display){this.targetHide();this.timerHold=null;}
return this;},targetShow:function(){o.cornerClear();this.display=true;this.container().setWidth().position();this.target.show();if($.isFunction(this.s.showCall)){this.s.showCall.call(this.trigger,this.target);}
return this;},targetHide:function(){this.display=false;this.targetClear();this.cornerClear();if($.isFunction(this.s.hideCall)){this.s.hideCall.call(this.trigger);}
this.target=null;this.trigger=null;this.s={};this.targetProtect=false;return this;},targetClear:function(){if(this.target){if(this.target.data("width")){this.target.removeData("width").removeData("height");}
if(this.targetProtect){this.target.children().hide().appendTo($("body"));}
this.target.unbind().hide();}},cornerClear:function(){if(this.corner){this.corner.remove();}},target:null,trigger:null,s:{},cacheData:{},targetProtect:false};$.powerFloat={};$.powerFloat.hide=function(){o.targetHide();};;var dateEles=[];function hideAllDate(){for(var i=0;i<dateEles.length;i++){dateEles[i].hide();}}
$.fn.TN_date=function(settings){settings=jQuery.extend({wrap:'#wrap',dateW:'tnDateW',tnStartDate:'date_t_pre',tnEndDate:'date_t_next',maxStartFromNow:270,maxLeaveFromNow:271,maxLeaveFromStart:28},settings);var dateMask=settings.mask||'yyyy-mm-dd';var jQueryMatchedObj=this;var startDateArea=$(this[0]);var endDateArea=$(this[1]);var dateWObj;var tnStartDateObj;var tnEndDateObj;var nowTarget;var monthnames=new Array("1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月");var monthdays,todayDate,thisday,thismonth,thisdate,thisyear;var fthisday,fthismonth,fthisyear,ftodayDate;function _initialize(){stateC(startDateArea);stateC(endDateArea);_initDate();dateWObj=$('<div class="'+settings.dateW+'"></div>').appendTo(settings.wrap);dateWObj.mousedown(function(event){event.stopPropagation();});dateWObj.hide();dateEles.push(dateWObj);tnStartDateObj=$('<div class="'+settings.tnStartDate+'"></div>').appendTo(dateWObj);tnEndDateObj=$('<div class="'+settings.tnEndDate+'"></div>').appendTo(dateWObj);dateWObj.delegate('.tdCobj','mouseover',function(){$(this).addClass('tdCobjS');}).delegate('.tdCobj','mouseout',function(){$(this).removeClass('tdCobjS');}).undelegate('click').delegate('.tdCobj','click',function(){nowTarget.val($(this).attr('data-id'));var selectWeek=nowTarget.val();if(settings.onSelect){settings.onSelect(selectWeek,nowTarget);}
dateWObj.hide();var nowWeek=getWeekday(selectWeek);$(document).unbind('mousedown',hideDateObj);if(nowTarget[0]==startDateArea[0]){if(endDateArea.val()!=dateMask&&endDateArea.val()!=''){var startDateStr=Date.formatDateStr(startDateArea.val());var startDate=new Date(startDateStr);var endDateStr=Date.formatDateStr(endDateArea.val());var endDate=new Date(endDateStr);if(+startDate>=+endDate){endDateStr=GetDate(startDate,1).getFormatDateStr('-');endDateArea.val(endDateStr);if(settings.onSelect){settings.onSelect(endDateStr,endDateArea);}
var tt=getWeekday(endDateStr);endDateArea.parent().find(".date").html(tt);}
startDateArea.parent().find(".date").html(nowWeek);}
if(!endDateArea[0].readOnly&&!endDateArea.hasClass('disabled')){endDateArea.focus();}}else if(nowTarget[0]==endDateArea[0]){if(startDateArea.val()!=dateMask&&startDateArea.val()!=''){endDateArea.parent().find(".date").html(nowWeek);}else{startDateArea.focus();}}});dateWObj.delegate('a.pre_link','click',function(){return MoveDate('pre')});dateWObj.delegate('a.next_link','click',function(){return MoveDate('next')});startDateArea.focus(function(){if(!this.readOnly){focusInputProcess($(this));}}).blur(function(){blurTxtProcess($(this));}).keydown(function(){return false;}).mousedown(function(event){}).bind('contextmenu',function(e){e.preventDefault();});var endFocus=false;endDateArea.focus(function(){var _this=$(this);endFocus=false;if(!this.readOnly&&!_this.hasClass('disabled')){endFocus=true;focusInputProcess(_this);}}).blur(function(){var _this=$(this);if(!_this.hasClass('disabled')){blurTxtProcess(_this);}}).keydown(function(){return false;}).click(function(event){var _this=$(this);if(!endFocus){if(!this.readOnly&&!_this.hasClass('disabled')){focusInputProcess(_this);endFocus=false;}}}).bind('contextmenu',function(e){e.preventDefault();});$(window).resize(function(){if(dateWObj.is(':visible'))posDate();});};function GetDate(pdate,AddDayCount){pdate.setDate(pdate.getDate()+AddDayCount);return pdate;}
function GetDateStr(pdate,AddDayCount){var dd=pdate;dd.setDate(dd.getDate()+AddDayCount);var y=dd.getYear();y=y%100;y=((y<50)?(2000+y):(1900+y));var m=dd.getMonth()+1;var d=dd.getDate();return y+"-"+adjustNumber(m)+"-"+adjustNumber(d);}
function stateC(obj){if(obj.val()==dateMask||obj.val()==''){if(obj.val()=='')obj.val(dateMask);}
else{}}
function focusInputProcess(obj){hideAllDate();nowTarget=obj;var ptip=false;if((obj.val()==dateMask&&nowTarget[0]==startDateArea[0])||(obj.val()==dateMask&&startDateArea.val()==dateMask&&nowTarget[0]==endDateArea[0])){obj.val('');ftodayDate=thisdate;fthisday=thisday;fthismonth=thismonth;fthisyear=thisyear;}
else if(nowTarget[0]==startDateArea[0]){var tArr=obj.val().split('-');var gddayDate=new Date(tArr[0],tArr[1]-1,tArr[2]);fthisday=gddayDate.getDay();fthismonth=gddayDate.getMonth();fthisyear=gddayDate.getYear();fthisyear=fthisyear%100;fthisyear=((fthisyear<50)?(2000+fthisyear):(1900+fthisyear));ftodayDate=gddayDate.getDate();}
else if(nowTarget[0]==endDateArea[0]){if(startDateArea.val()!=dateMask){var tArr;if(endDateArea.val()!=dateMask)
tArr=obj.val().split('-');else
tArr=startDateArea.val().split('-');var tArr2=startDateArea.val().split('-');if(tArr[0]==tArr2[0]&&tArr[1]==tArr2[1])ptip=true;var gddayDate=new Date(tArr[0],tArr[1]-1,tArr[2]);fthisday=gddayDate.getDay();fthismonth=gddayDate.getMonth();fthisyear=gddayDate.getYear();fthisyear=fthisyear%100;fthisyear=((fthisyear<50)?(2000+fthisyear):(1900+fthisyear));ftodayDate=gddayDate.getDate();}
else{var tArr=obj.val().split('-');var gddayDate=new Date(tArr[0],tArr[1]-1,tArr[2]);fthisday=gddayDate.getDay();fthismonth=gddayDate.getMonth();fthisyear=gddayDate.getYear();fthisyear=fthisyear%100;fthisyear=((fthisyear<50)?(2000+fthisyear):(1900+fthisyear));ftodayDate=gddayDate.getDate();}}
formDate(ptip);posDate();dateWObj.show();preDocEvent();}
function formDate(ctip){var nday=fthisday;var nmonth=fthismonth;var nyear=fthisyear;var ndate=ftodayDate;var nextMonthObj=_getPreAndNextMoth('n');fthisday=nextMonthObj.xDay;fthismonth=nextMonthObj.xMonth;fthisyear=nextMonthObj.xYear;ftodayDate=1;var outStr,outStr2;if((nyear==thisyear&&nmonth==thismonth)||ctip){outStr=('<div class="date_t_b"><div class="pre_month"><span class="pre_link">&lt;</span>'+nyear+"年"+monthnames[nmonth]+'</div>')+_createDate(nyear,nmonth,ndate,nday);}
else{outStr=('<div class="date_t_b"><div class="pre_month"><a href="#" class="pre_link">&lt;</a>'+nyear+"年"+monthnames[nmonth]+'</div>')+_createDate(nyear,nmonth,ndate,nday);}
outStr2=('<div class="date_t_b"><div class="next_month"><a href="#" class="next_link">&gt;</a>'+nextMonthObj.xYear+"年"+monthnames[nextMonthObj.xMonth]+'</div>')+_createDate(nextMonthObj.xYear,nextMonthObj.xMonth,1,nextMonthObj.xDay);tnStartDateObj.html(outStr);tnEndDateObj.html(outStr2);bl_height();}
function posDate(){var wrapOffset=settings.wrap.offset();var pos=nowTarget.offset();var posL=pos.left;var posT=pos.top+nowTarget.outerHeight()+1;dateWObj.css({'left':posL-wrapOffset.left,'top':posT-wrapOffset.top});}
function blurTxtProcess(obj){if(obj.val()==''){obj.val(dateMask);}
else if(obj.val()!=dateMask){}}
function _initDate(){todayDate=new Date();var tArr=GetDateStr(todayDate,0).split('-');todayDate=new Date(tArr[0],tArr[1]-1,tArr[2]);thisday=todayDate.getDay();thismonth=todayDate.getMonth();thisdate=todayDate.getDate();thisyear=todayDate.getYear();thisyear=thisyear%100;thisyear=((thisyear<50)?(2000+thisyear):(1900+thisyear));ftodayDate=thisdate;fthisday=thisday;fthismonth=thismonth;fthisyear=thisyear;}
function preDocEvent(){$(document).unbind('mousedown',hideDateObj);$(document).mousedown(hideDateObj);}
function bl_height(){var sNum=tnStartDateObj.find('tr').length;var eNum=tnEndDateObj.find('tr').length;var astr='<tr><td>&nbsp;</td><td></td><td></td><td></td><td></td><td></td><td></td></tr>';if(sNum>eNum){tnEndDateObj.find('table').append(astr);}
else if(eNum>sNum){tnStartDateObj.find('table').append(astr);}
else{}}
function hideDateObj(){$(document).unbind('mousedown',hideDateObj);dateWObj.hide();initTxt(startDateArea);if(!endDateArea.hasClass('disabled')){initTxt(endDateArea);}}
function initTxt(obj){if(obj.val()==''){obj.val(dateMask);}
else if(obj.val()!=dateMask){}
else{}}
function MoveDate(direction){var nextMonthObj;var nextMonthObj2;if(direction=='pre'){nextMonthObj=_getPreAndNextMoth('p');fthisday=nextMonthObj.xDay;fthismonth=nextMonthObj.xMonth;fthisyear=nextMonthObj.xYear;nextMonthObj2=_getPreAndNextMoth('p');var outStr,outStr2;if(nextMonthObj2.xYear==thisyear&&nextMonthObj2.xMonth==thismonth){outStr=_pickDateStr(thisyear,thismonth,thisyear,thismonth,thisdate,thisday,'p',true,true);outStr2=_pickDateStr(fthisyear,fthismonth,fthisyear,fthismonth,1,fthisday,'n',true,true);}
else{outStr=_pickDateStr(nextMonthObj2.xYear,nextMonthObj2.xMonth,nextMonthObj2.xYear,nextMonthObj2.xMonth,1,nextMonthObj2.xDay,'p',false,true);outStr2=_pickDateStr(fthisyear,fthismonth,fthisyear,fthismonth,1,fthisday,'n',true,true);}
tnStartDateObj.html(outStr);tnEndDateObj.html(outStr2);}
else{nextMonthObj=_getPreAndNextMoth('n');var outStr,outStr2;outStr=_pickDateStr(fthisyear,fthismonth,fthisyear,fthismonth,1,fthisday,'p',false,false);outStr2=_pickDateStr(nextMonthObj.xYear,nextMonthObj.xMonth,nextMonthObj.xYear,nextMonthObj.xMonth,1,nextMonthObj.xDay,'n',true,false);tnStartDateObj.html(outStr);tnEndDateObj.html(outStr2);}
bl_height();fthisday=nextMonthObj.xDay;fthismonth=nextMonthObj.xMonth;fthisyear=nextMonthObj.xYear;return false;}
function _pickDateStr(xyear,xmonth,cyear,cmonth,cdate,cday,PNtip,btip,qtip){var outStr='';var stip=false;if(nowTarget[0]==endDateArea[0]&&startDateArea.val()!=''&&startDateArea.val()!=dateMask&&qtip){var tArr=startDateArea.val().split('-');if(fthisyear==tArr[0]&&fthismonth==tArr[1])
stip=true;}
if(PNtip=='p'){outStr+='<div class="date_t_b"><div class="pre_month">';if(btip||stip){outStr+='<span class="pre_link">&lt;</span>';}
else{outStr+='<a href="#" class="pre_link">&lt;</a>';}}
else{outStr+='<div class="date_t_b"><div class="next_month"><a href="#" class="next_link">&gt;</a>';}
outStr+=(xyear+"年"+monthnames[xmonth]+'</div>'+_createDate(cyear,cmonth,cdate,cday));return outStr;}
function _getPreAndNextMoth(pntip){var gdYear=0;var gdMonth=0;if(pntip=='n'){if(fthismonth<11){gdMonth=fthismonth+1;gdYear=fthisyear;}
else{gdMonth=0;gdYear=fthisyear+1;}}
else{if(fthismonth>0){gdMonth=fthismonth-1;gdYear=fthisyear;}
else{gdMonth=11;gdYear=fthisyear-1;}}
var gddayDate=new Date(gdYear,gdMonth,1);var fthisgdday=gddayDate.getDay();var fthisgdmonth=gddayDate.getMonth();var fthisgdyear=gddayDate.getYear();fthisgdyear=fthisgdyear%100;fthisgdyear=((fthisgdyear<50)?(2000+fthisgdyear):(1900+fthisgdyear));return{'xYear':fthisgdyear,'xMonth':fthisgdmonth,'xDay':fthisgdday};}
function _createDate(gYear,gMonth,gDate,gDay){var startArr=[];var endArr=[];var sttip=false;var entip=false;var disabledEndDate=endDateArea[0].disabled;if(startDateArea.val()!=''&&startDateArea.val()!=dateMask){sttip=true;startArr=startDateArea.val().split('-');}
if(endDateArea.val()!=''&&endDateArea.val()!=dateMask&&!disabledEndDate){entip=true;endArr=endDateArea.val().split('-');}
var monthdays=new Array(31,28,31,30,31,30,31,31,30,31,30,31);if(((gYear%4==0)&&!(gYear%100==0))||(gYear%400==0)){monthdays[1]++;}
var outStr='';var tAddStr='<td class="tdCobj tdCobjN"';var tempDate;var ftempDate;if(nowTarget[0]==startDateArea[0]){if(gYear==thisyear&&gMonth==thismonth){tempDate=thisdate;}
else{tempDate=1;}}
else if(nowTarget[0]==endDateArea[0]){tAddStr='<td class="tdCobj tdCobjN"';if(startDateArea.val()!=''&&startDateArea.val()!=dateMask){var tArr=startDateArea.val().split('-');if(gYear==tArr[0]&&gMonth==tArr[1]-1){tempDate=tArr[2];}
else{tempDate=1;}}
else{if(gYear==thisyear&&gMonth==thismonth){tempDate=thisdate;}
else{tempDate=1;}}}
else{}
var startspaces=gDate;while(startspaces>7){startspaces-=7;}
startspaces=gDay-startspaces+1;if(startspaces<0){startspaces+=7;}
outStr+='<table cellpadding="0" cellspacing="0" border="0" class="dateSel_t">';outStr+='<tr>';outStr+='<th align="center" style="color:#ff9900"><strong>日</strong></th>';outStr+='<th align="center">一</th>';outStr+='<th align="center">二</th>';outStr+='<th align="center">三</th>';outStr+='<th align="center">四</th>';outStr+='<th align="center">五</th>';outStr+='<th align="center" style="color:#ff9900"><strong>六</strong></th>';outStr+='</tr>';outStr+='<tr>';for(s=0;s<startspaces;s++){outStr+='<td></td>';}
var count=1;while(count<=monthdays[gMonth]){for(var b=startspaces;b<7;b++){if(count<=monthdays[gMonth]){var tetip=false;if(nowTarget[0]==endDateArea[0]){var teDate=GetDate(new Date,settings.maxLeaveFromNow);var tpDate=new Date(gYear,gMonth,count);if(tpDate>teDate)tetip=true;teDate=new Date(startArr.join('/'));if(+tpDate<=+teDate)tetip=true;}else if(nowTarget[0]===startDateArea[0]){var teDate=GetDate(new Date,settings.maxStartFromNow);var tpDate=new Date(gYear,gMonth,count);if(tpDate>teDate)tetip=true;}
if(count<tempDate||tetip){outStr+='<td>';}
else{if(sttip&&entip){if(nowTarget[0]==startDateArea[0]){if((startArr[0]==gYear.toString()&&startArr[1]==adjustNumber(gMonth+1)&&startArr[2]==adjustNumber(count)))
outStr+=tAddStr;else
outStr+='<td class="tdCobj"';}
else{if(startArr[0]==gYear.toString()&&startArr[1]==adjustNumber(gMonth+1)&&startArr[2]==adjustNumber(count))
outStr+=tAddStr;else if(endArr[0]==gYear.toString()&&!disabledEndDate&&endArr[1]==adjustNumber(gMonth+1)&&endArr[2]==adjustNumber(count)){outStr+='<td class="tdCobj tdCobjN"';}
else
outStr+='<td class="tdCobj"';}}
else if(sttip||entip){if(sttip){if(startArr[0]==gYear.toString()&&startArr[1]==adjustNumber(gMonth+1)&&startArr[2]==adjustNumber(count))
outStr+=tAddStr;else
outStr+='<td class="tdCobj"';}
else if(entip){if(endArr[0]==gYear.toString()&&endArr[1]==adjustNumber(gMonth+1)&&endArr[2]==adjustNumber(count))
outStr+=tAddStr;else
outStr+='<td class="tdCobj"';}
else{}}
else{outStr+='<td class="tdCobj"';}
outStr+=(' data-id="'+gYear.toString()+'-'+adjustNumber(gMonth+1)+'-'+adjustNumber(count)+'">');}
outStr+=count.toString();}
outStr+='</td>';count++;}
outStr+='</tr>';startspaces=0;}
outStr+='</table>';return outStr;}
function adjustNumber(number,len){number+='';len=len||2;var length=number.length;if(length<len){for(var i=len-length;i>0;i--){number='0'+number;}}
return number;}
function getWeekday(sDate){var dt=new Date(sDate.replace(/-/g,'/'));var todayDate=new Date();var strArr1=GetDateStr(todayDate,0).split('-');var strArr2=GetDateStr(dt,0).split('-');var str11=new Date(strArr1[0],strArr1[1]-1,strArr1[2]);var str22=new Date(strArr2[0],strArr2[1]-1,strArr2[2]);var a=['星期日','星期一','星期二','星期三','星期四','星期五','星期六'];var result=(str22-str11)/3600000;switch(result){case 0:return"今天";break;case 24:return"明天";break;case 48:return"后天";break;default:return a[dt.getDay()];}}
_initialize();};var reEscape=new RegExp('(\\'+['/','.','*','+','?','|','(',')','[',']','{','}','\\'].join('|\\')+')','g');function fnFormatResult(value,data,currentValue){var pattern='('+currentValue.replace(reEscape,'\\$1')+')';return value.replace(new RegExp(pattern,'gi'),'<strong>$1<\/strong>');}
function Autocomplete(el,options){this.el=$(el);this.el.attr('autocomplete','off');this.suggestions=[];this.data=[];this.badQueries=[];this.selectedIndex=-1;this.currentValue=this.el.val();this.intervalId=0;this.cachedResponse=[];this.onChangeInterval=null;this.ignoreValueChange=false;this.serviceUrl=options.serviceUrl;this.isOuter=options.isOuter;this.isLocal=false;this.options={autoSubmit:false,minChars:1,maxHeight:300,deferRequestBy:0,width:0,highlight:true,params:{},fnFormatResult:fnFormatResult,delimiter:null,channel:'',zIndex:9999};this.initialize();this.setOptions(options);}
$.fn.autocompleteHotel=function(options){return new Autocomplete(this.get(0)||$('<input />'),options);};Autocomplete.prototype={killerFn:null,initialize:function(){var me,uid,autocompleteElId;me=this;uid=Math.floor(Math.random()*0x100000).toString(16);autocompleteElId='Autocomplete_'+uid;this.killerFn=function(e){if($(e.target).parents('.autocomplete').size()===0){me.killSuggestions();me.disableKillerFn();}};if(!this.options.width){this.options.width=this.el.width();}
this.mainContainerId='AutocompleteContainter_'+uid;$('<div id="'+this.mainContainerId+'" style="position:absolute;z-index:9999;"><div class="autocomplete-w1"><div class="autocomplete" id="'+autocompleteElId+'" style="display:none; width:310px;"></div></div></div>').appendTo('body');this.container=$('#'+autocompleteElId);this.fixPosition();if(window.opera){this.el.keypress(function(e){me.onKeyPress(e);});}else{this.el.keydown(function(e){me.onKeyPress(e);});}
this.el.keyup(function(e){me.onKeyUp(e);});this.el.blur(function(){me.enableKillerFn();});this.el.focus(function(){me.fixPosition();});},setOptions:function(options){var o=this.options;$.extend(o,options);if(o.lookup){this.isLocal=true;if($.isArray(o.lookup)){o.lookup={suggestions:o.lookup,data:[]};}}
$('#'+this.mainContainerId).css({zIndex:o.zIndex});this.container.css({maxHeight:o.maxHeight+'px',width:o.width});},clearCache:function(){this.cachedResponse=[];this.badQueries=[];},disable:function(){this.disabled=true;},enable:function(){this.disabled=false;},fixPosition:function(){var offset=this.el.offset();$('#'+this.mainContainerId).css({top:(offset.top+this.el.innerHeight())+'px',left:offset.left+'px'});},enableKillerFn:function(){var me=this;$(document).bind('click',me.killerFn);},disableKillerFn:function(){var me=this;$(document).unbind('click',me.killerFn);},killSuggestions:function(){var me=this;this.stopKillSuggestions();this.intervalId=window.setInterval(function(){me.hide();me.stopKillSuggestions();},300);},stopKillSuggestions:function(){window.clearInterval(this.intervalId);},onKeyPress:function(e){if(this.disabled||!this.enabled){return;}
switch(e.keyCode){case 27:this.writeValue(this.currentValue);this.hide();break;case 9:case 13:if(this.selectedIndex===-1){this.hide();return;}
this.select(this.selectedIndex);if(e.keyCode===9){return;}
break;case 38:this.moveUp();break;case 40:this.moveDown();break;default:return;}
e.stopImmediatePropagation();e.preventDefault();},onKeyUp:function(e){if(this.disabled){return;}
switch(e.keyCode){case 38:case 40:return;}
clearInterval(this.onChangeInterval);if(this.currentValue!==this.el.val()){if(this.options.deferRequestBy>0){var me=this;this.onChangeInterval=setInterval(function(){me.onValueChange();},this.options.deferRequestBy);}else{this.onValueChange();}}},onValueChange:function(){clearInterval(this.onChangeInterval);this.currentValue=this.el.val();var q=this.getQuery(this.currentValue);this.selectedIndex=-1;if(this.ignoreValueChange){this.ignoreValueChange=false;return;}
if(q===''||q.length<this.options.minChars){this.hide();}else{this.getSuggestions(q);}},getQuery:function(val){var d,arr;d=this.options.delimiter;if(!d){return $.trim(val);}
arr=val.split(d);return $.trim(arr[arr.length-1]);},getSuggestionsLocal:function(q){var ret,arr,len,val,i;arr=this.options.lookup;len=arr.suggestions.length;ret={suggestions:[],data:[]};q=q.toLowerCase();for(i=0;i<len;i++){val=arr.suggestions[i];if(val.toLowerCase().indexOf(q)===0){ret.suggestions.push(val);ret.data.push(arr.data[i]);}}
return ret;},getSuggestions:function(q){var cr,me;cr=this.isLocal?this.getSuggestionsLocal(q):this.cachedResponse[q];if(cr&&$.isArray(cr.suggestions)){this.suggestions=cr.suggestions;this.data=cr.data;this.suggest();}else if(!this.isBadQuery(q)){me=this;me.options.params.query=q;if(this.isOuter){var url=this.serviceUrl+"?query="+q+"&format=json&jsoncallback=?";url=encodeURI(url);$.getJSON(url,function(json){me.processResponse(json);});}else{$.get(this.serviceUrl,me.options.params,function(txt){me.processResponse(txt);},'text');}}},isBadQuery:function(q){var i=this.badQueries.length;while(i--){if(q.indexOf(this.badQueries[i])===0){return true;}}
return false;},hide:function(){this.enabled=false;this.selectedIndex=-1;this.container.hide();},suggest:function(){if(this.suggestions.length===0&&this.options.channel!=='hotel'){this.hide();return;}
var me,len,div,f,v,i,s,mOver,mClick;me=this;len=this.suggestions.length;f=this.options.fnFormatResult;v=this.getQuery(this.currentValue);mOver=function(xi){return function(){me.activate(xi);};};mClick=function(xi){return function(){me.select(xi);};};this.container.hide().empty();for(i=0;i<len;i++){s=this.suggestions[i];if(this.options.channel==='hotel'){div=$((me.selectedIndex===i?'<div class="selected row"':'<div class="row"')+' title=""><div class="clearfix" style="padding:0;">'+'<span>'+((s.type===2||s.subType===47)?(s.keyword+'('+s.cityName+')'):s.keyword)+'</span></div></div>');if(i==0){div.find('span').css({'background':'#63ca33','color':'#fff'});}}
else{div=$((me.selectedIndex===i?'<div class="selected row"':'<div class="row"')+' title="'+s+'">'+f(s,this.data[i],v)+'</div>');}
div.mouseover(mOver(i));div.mouseover(function(){$(this).find('span').css({'background':'#63ca33','color':'#fff'});});div.mouseout(function(){$(this).find('span').css({'background':'#fff','color':'#404040'});});div.click(mClick(i));this.container.append(div);}
if(!len){div=$('<div>暂不支持该目的地</div>');div.css({'background':'#ffebea','color':'#fb3b39'});this.container.append(div);}
if(this.options.channel==='hotel'){this.container.css({'width':'190px'});this.container.find('span').css({'width':'190px','float':'left','text-align':'left','overflow':'hidden'});$('#city_hotresults').hide();}
this.enabled=true;this.container.show();},processResponse:function(text){var response;if(this.isOuter){response=text;}else{try{response=eval('('+text+')');}catch(err){return;}}
if(!$.isArray(response.data)){response.data=[];}
if(!this.options.noCache){this.cachedResponse[response.query]=response;if(response.suggestions.length===0){this.badQueries.push(response.query);}}
if(response.query===this.getQuery(this.currentValue)){this.suggestions=response.suggestions;this.data=response.data;this.suggest();}},activate:function(index){var divs,activeItem;divs=this.container.children();this.selectedIndex=index;if(this.selectedIndex!==-1&&divs.length>this.selectedIndex){activeItem=divs.get(this.selectedIndex);}
return activeItem;},deactivate:function(div,index){div.className='';if(this.selectedIndex===index){this.selectedIndex=-1;}},select:function(i){var selectedValue,f;selectedValue=this.suggestions[i];if(selectedValue){this.writeValue(selectedValue);if(this.options.autoSubmit){f=this.el.parents('form');if(f.length>0){f.get(0).submit();}}
this.ignoreValueChange=true;this.hide();this.onSelect(i);}},writeValue:function(selectedValue){if(this.options.channel==='hotel'){if(selectedValue.type===2||selectedValue.subType===47){this.el.val(selectedValue.cityName);$('#keyWord').attr('data-id',selectedValue.id);$('#keyWord').val(selectedValue.keyword);}
else{this.el.val(selectedValue.keyword);$('#keyWord').val('酒店名/位置/品牌');}
if(selectedValue.keyword=='金门县'){this.el.val(selectedValue.keyword);$('#keyWord').val('酒店名/位置/品牌');}}
else{this.el.val(selectedValue);}},moveUp:function(){if(this.selectedIndex===-1){return;}
if(this.selectedIndex===0){this.container.children().get(0).className='';this.selectedIndex=-1;this.writeValue(this.currentValue);return;}
this.adjustScroll(this.selectedIndex-1);},moveDown:function(){if(this.selectedIndex===(this.suggestions.length-1)){return;}
this.adjustScroll(this.selectedIndex+1);},adjustScroll:function(i){var activeItem,offsetTop,upperBound,lowerBound;activeItem=this.activate(i);offsetTop=activeItem.offsetTop;upperBound=this.container.scrollTop();lowerBound=upperBound+this.options.maxHeight-25;if(offsetTop<upperBound){this.container.scrollTop(offsetTop);}else if(offsetTop>lowerBound){this.container.scrollTop(offsetTop-this.options.maxHeight+25);}
this.writeValue(this.suggestions[i]);},onSelect:function(i){var me,fn,s,d;me=this;fn=me.options.onSelect;s=me.suggestions[i];d=me.data[i];me.writeValue(s);if(this.options.channel==='hotel'){s=(s.type===2||s.subType===47)?s.cityName:s.keyword;}
if($.isFunction(fn)){fn(s,d,me.el);}},getValue:function(value){var del,currVal,arr,me;me=this;del=me.options.delimiter;if(!del){return value;}
currVal=me.currentValue;arr=currVal.split(del);if(arr.length===1){return value;}
return currVal.substr(0,currVal.length-arr[arr.length-1].length)+value;}};;var hotelSearchBox={city:'',keywords:0,cityDefaultVal:'请输入目的地',keywords:'',keywordsDefaultVal:'酒店名/位置/品牌',beginDate:'',endDate:'',autoObj:null,init:function(){var This=this;this.city=$('#txtCity');this.keywords=$('#keyWord');this.beginDate=$('#begin_date');this.endDate=$('#end_date');this.city.blur(this.cityFocus);this.txtCityIconClick();this.city.change(this.cityChange);this.cityAutoComplete();this.keywords.blur(this.keywordsBlur);this.keywords.focus(this.keywordsFocus);this.popCitiesBox();this.popCityAreaInfo();this.popContentHandle();this.submitSearch();this.mapSearch();this.getCityPoi(this.city.val());this.tipMsgClose();},showHistory:function(){$('.host_list').find('dt').live({'mouseenter':function(){$(this).css('color','#49ab1e');},'mouseleave':function(){$(this).css('color','#333');}})
$('.host_list').live('click',function(){var cityName=$(this).find('dt').html();var checkdate=$(this).find('dd').html();var tmpArr=checkdate.split("至");var checkinDate=tmpArr[0];var checkoutDate=tmpArr[1];$('#txtCity').val(cityName);$('#begin_date').val(checkinDate);$('#end_date').val(checkoutDate);$(".search_host").removeClass("m_over");$(".search_addul").removeClass("m_over");$(".search_host").find("em:eq(0)").html('&#xe61f;');return false;});},tmpVal:{'cityPOICache':{}},cityFocus:function(e){var _s=hotelSearchBox;if(_s.city.hasClass('error'))
_s.city.removeClass('error');if(!$.trim(_s.city.val())){_s.city.val(_s.cityDefaultVal);}
if(_s.city&&$.trim(_s.city.val())===_s.cityDefaultVal){_s.city.addClass('grey');}else{if(_s.autoObj.suggestions.length){_s.city.val(_s.autoObj.suggestions[0].keyword);}
_s.city&&_s.city.removeClass('grey');}},txtCityIconClick:function(){$('#txtCity_icon').click(function(){$('#txtCity').trigger('click');});},cityChange:function(e){var _s=hotelSearchBox;$('#ct').val(1);if(!cleanCityName(_s.city.val())){$('#popCityLists').html('');_s.keywords.val(_s.keywordsDefaultVal);}else{$('#popCityLists').html('');_s.getCityPoi(_s.city.val());}},cityAutoComplete:function(){var _s=this;var autocomplete_options={channel:'hotel',serviceUrl:'/ajax/citySuggestion',onSelect:function(s){_s.getCityPoi(s);},selectFirst:true,isOuter:true};_s.autoObj=_s.city.autocompleteHotel(autocomplete_options);_s.city.keydown(function(){if($(".autocomplete").css("display")==="block"){$("#city_hotresults").hide();}});},keywordsBlur:function(e){var _s=hotelSearchBox;if(!$.trim(_s.keywords.val())){_s.keywords.val("酒店名/位置/品牌");}else if($.trim(_s.keywords.val())=="酒店名/位置/品牌"){_s.keywords.val('');}},keywordsFocus:function(e){var _s=hotelSearchBox;if($.trim(_s.keywords.val())=="酒店名/位置/品牌"){_s.keywords.val('');}},popCitiesBox:function(){var _s=this;_s.city.powerFloat({eventType:"click",offsets:{x:0,y:0},target:$("#city_hotresults"),showCall:function(){if(_s.city.hasClass('error')){_s.city.removeClass('error');_s.city.siblings('.dest_hint').css('display','none');}
$(this).select();}});},popCityAreaInfo:function(){var _s=this;_s.keywords.powerFloat({eventType:"click",offsets:{x:0,y:0},target:$("#city_keyword"),position:'4-1',edgeAdjust:false,showCall:function(){if($('#popCityLists').html()==''){$.powerFloat.hide();return;}
$(this).select();$("html,body").animate({scrollTop:176},500);},hideCall:function(){$("html,body").animate({scrollTop:176},500);}});},popContentHandle:function(){var _s=this;var cityHotresults=$("#city_hotresults");var txtCity=_s.city;var keyWord=_s.keywords;var $popCityBox=$('#popCity_box');var popcitylist=$('#popCity_box').find(".popcitylist");cityHotresults.find(".popcitytit").each(function(i,n){$(n).find("li").click(function(){var _this=$(this);_this.addClass("cur").siblings().removeClass("cur");popcitylist.eq(_this.index()).show().siblings().hide();});});$popCityBox.on('click','li a',function(e){var cityName,cityCode,$this;$this=$(this);cityName=$this.attr('title');cityCode=$this.attr('code');txtCity.val(cityName).removeClass("grey").attr('data-id',cityCode);txtCity.trigger('click');txtCity.trigger('cityChange',{code:cityCode,name:cityName});keyWord.val('酒店名/位置/品牌');_s.getCityPoi(cityName);});$('#popCityLists').find('.popcitylist').find("li").live('click',function(){var name,$this;$this=$(this);name=$this.attr('title');keyWord.val(name).removeClass("grey");keyWord.trigger('click');});},getCityPoi:function(c){var _s=this;if(_s.tmpVal.cityPOICache[c]){_s.updateCityPoiList(_s.tmpVal.cityPOICache[c]);return false;}
$.ajax({url:'/ajax/CityPOI',type:'post',dataType:'json',data:{city:c,limit:20},success:function(s){var _str=[];var _ul_tit=['行政区','商圈','景点','交通枢纽'];var _index=0;for(var poi in s){if(s[poi].length==0){_index++;continue;}
_str.push('<ul class="popcitylist clearfix">');_str.push('<div class="dt">'+_ul_tit[_index++]+'</div>');var tmp=s[poi];for(var p in tmp){_str.push('<li data="'+tmp[p].id+'" class="'+'" title="'+tmp[p].name+'">'+tmp[p].name+'</li>');}
_str.push('</ul>');}
var strs=_str.join('');_s.tmpVal.cityPOICache[c]=strs;_s.tmpVal.cityPOICache['position_'+c]=s;_s.updateCityPoiList(strs);},error:function(e){}});},updateCityPoiList:function(htmlStr){$('#popCityLists').html(htmlStr);},updateTitleAndCrumbs:function(){var city=$('#txtCity').val();var poi_name=$('#filter_show a.selected').text()||'';var brand_str='';$('#filter_brand a.selected').each(function(i,d){brand_str+=$(d).text()+',';});var star_name='';$('#filter_star a.selected').each(function(i,d){star_name+=$(d).text()+','});document.title=city+'酒店预订_'+city+poi_name+'附近'+brand_str+star_name+'宾馆查询_途牛';$('.crumbs').next('h1').html(city+'酒店');},beginAndEndDateClick:function(){$('#begin_date,#end_date').TN_date();$('#inDateWeek,#begin_date_icon').click(function(){$('#begin_date').trigger('focus');})
$('#outDateWeek,#end_date_icon').click(function(){$('#end_date').trigger('focus');})},submitSearch:function(){var _s=this;$('#search_hotel').click(function(e){var txtCity=_s.city;var cityValue=cleanCityName(txtCity.val());txtCity.val(cityValue);if(cityValue==""||cityValue=='请输入目的地'){$('.autocomplete')&&$('.autocomplete').css('display','none');txtCity.addClass("error").val('');_s.showError('请选择目的地!',txtCity);txtCity.focus();return false;}
if(cityValue==""||cityValue=="城市名"){txtCity.addClass("err");if($('#com_bug_index').length){$('#com_bug_index').show();return false;}
var com_bug=$('<div id="com_bug_index" class="com_bug"><div class="w">请输入城市名称，且不可包含*&+等符号及阿拉伯数字。</div></div>');com_bug.appendTo("body");com_bug.css({top:txtCity.offset().top,left:txtCity.offset().left+270}).click(function(e){stopPropagation(e);});return false;}
var cityCode=parseInt(txtCity.attr('data-id'));if(!cityCode&&$('#popCity_box .popcitylist a[title='+cityValue+']').get(0)){cityCode=$('#popCity_box .popcitylist a[title='+cityValue+']').attr('code');}
if(!cityCode){_s.showError('对不起，不支持该目的地!',txtCity);return false;}
if(_s.autoObj){var len=_s.autoObj.suggestions.length;var keywordsExists=false;for(var i=0;i<len;i++){if(cityValue==_s.autoObj.suggestions[i].keyword){keywordsExists=true;break;}}
if($('#popCity_box .popcitylist a[title='+cityValue+']').get(0)){keywordsExists=true;}
if(!keywordsExists){_s.showError('请选择合适的目的地!',txtCity);return false;}}
var date1=_s.beginDate.val();if(date1=="yyyy-mm-dd"){_s.showError('请选择入住日期!',_s.beginDate);return false;}
var date2=_s.endDate.val();if(date2=="yyyy-mm-dd"){_s.showError('请选择退房日期!',_s.endDate);return false;}
if(!validateDateLong()){return;}
var _url='/list/'+cityCode+'p0s0b0/?checkindate='+date1+'&checkoutdate='+date2;if($('#keyWord').val()!=='酒店名/位置/品牌'){var sPoiId=$('#popCityLists').find('li:[title="'+$.trim($('#keyWord').val())+'"]').attr('data');if($('#keyWord').attr('data-id')){var inList=$('#popCityLists').find('li:[data="'+$('#keyWord').attr('data-id')+'"]').attr('data');if(inList){sPoiId=$('#keyWord').attr('data-id');}}
if(sPoiId){if(typeof sPoiId==="number"){_url+='&poi='+sPoiId;}else{_url+='&poi='+sPoiId.match(/[\d]+/g)[0];}}else{_url+='&keyword='+cleanParams($('#keyWord').val());}}
window.location.href=encodeURI(_url);return;});},mapSearch:function(){var _s=this;$('#m_MapBtn').click(function(e){var txtCity=_s.city;var cityValue=cleanCityName(txtCity.val());var _url='/maplist/'+cityValue+'p0s0b0/';window.location.href=encodeURI(_url);})},tipMsgClose:function(){var _s=this;$(document).click(function(){if($("#com_bug")){$("#com_bug").remove();$('#end_date').removeClass("err");}
if($(".search_host").hasClass("m_over")){$(".search_host").removeClass("m_over");$(".search_addul").removeClass("m_over");$(".search_host").find("em:eq(0)").html('&#xe61f;');}
if($("#com_bug_index")){$("#com_bug_index").remove();$('#txtCity').removeClass("err");}
if($("#com_bug_list")){$("#com_bug_list").remove();$('#txtCity').removeClass("err");}
_s.hideErr();})},hotelErrTips:null,showError:function(msg,target){if(!this.hotelErrTips){this.hotelErrTips=$('<div class="hotel_err_tips"><span></span></div>');$('body').append(this.hotelErrTips);}
var offset=target.offset();var left=offset.left;var top=offset.top;var h=target.outerHeight();var w=target.outerWidth();var cssObj={position:"absolute","z-index":999,background:"#ffeaea",border:"1px solid #ffabab",color:"#fb3a3a",padding:"5px",top:top+h-1+'px',left:left+'px'};this.hotelErrTips.data('target',target).css(cssObj).show().find('span').text(msg);var w2=this.hotelErrTips.outerWidth();w2<w?this.hotelErrTips.css('width',w-2-10+'px'):null;target.addClass('err');},hideErr:function(){if(this.hotelErrTips){this.hotelErrTips.data('target').removeClass('err');this.hotelErrTips.hide();}}}
var roomCompare={compareCookieName:'roomComareInfo',init:function(){this.addContrast();this.goCompare();this.initCompareList();this.hotelContrastFix();},addContrast:function(){var _this=this;$("div.hotelAll").find(".contrast").on("click",function(){var rId=$(this).attr("data");var contrastListLiLength=$("#contrastList").find("li").length
if(contrastListLiLength<2){var roomCookieInfo=readCookie(_this.compareCookieName);if($.trim(roomCookieInfo)){var roomInfo=jQuery.parseJSON($.trim(roomCookieInfo));var len=_this.countObjProperties(roomInfo)
if(len>contrastListLiLength){$("#contrastList").empty();_this.initCompareList();if(len==2){return false;}}}}
if(contrastListLiLength){var found=false;$("#contrastList").find("li").each(function(){if($(this).attr('data')==rId){found=true;return false;}});if(found){return false;}}
if(contrastListLiLength<2){$(this).addClass("add");var _li=$(this).parent().parent().eq(0);if($('#hotelName').length){var hotelName=$('#hotelName').text();}else{var hotelName=$(this).attr("chotelName");}
var houseName=$(this).attr("cname");var priceStr=_li.find(".rw4 b.roomPrice").text();var price=priceStr.substr(1);var hId=$(this).attr("hid");_this.showCompareRoom(rId,hotelName,houseName,price,hId);_this.setRoomCookie(rId,hotelName,houseName,price,hId);}else{$("#compareTips").text('提示：一次只能比较两个房型！').fadeIn().fadeOut(1000);}})},showCompareRoom:function(id,hotelName,roomName,price,hId){var com_len=$('<li data='+id+'><div class="des"><p class="name clearfix"><a target="_blank" href="/detail/'+hId+'" title="'+unescape(hotelName)+'">'+unescape(hotelName)+'</a><span class="close">X</span></p><p class="oth clearfix"><span class="volume">'+unescape(roomName)+'</span><span class="price">￥<em>'+price+'</em></span></p></div></li>');com_len.appendTo("#contrastList");hotelPublic.leftDivFloat();this.closeContrastRoom();},closeContrastRoom:function(){var _this=this;$("#contrastList").find("li .close").click(function(){var li=$(this).parents("li").eq(0);_this.removeRoomCookie(li.attr('data'));li.remove();})},hotelContrastFix:function(){$("#scroll_btn").click(function(){if($(this).hasClass("selected")){$(this).removeClass("selected");$("#scrollFixWrap").css({'position':'static'});}else{var top=($(window).height())/2-50;$(this).addClass("selected");$("#scrollFixWrap").css({'position':'fixed','top':top});}})},goCompare:function(){$("#goto-contrast").click(function(){var contrastLen=$("#contrastList").find("li").length;if(contrastLen!=2){$("#compareTips").text('提示：请选择两个房型进行比较！').fadeIn().fadeOut(1000);return false;}else{var ids=[];$("#contrastList").find("li").each(function(){ids.push($(this).attr('data'));});var url='/compare/'+ids.join("/");$(this).find('a').attr('href',url);}})},removeRoomCookie:function(id){if(!$.trim(id)){return false;}
var roomCookieInfo=readCookie(this.compareCookieName);if($.trim(roomCookieInfo)){roomInfo=jQuery.parseJSON($.trim(roomCookieInfo));delete roomInfo[id];createCookie(this.compareCookieName,JSON.stringify(roomInfo),1)}},setRoomCookie:function(id,hotelName,roomName,price,hId){var value={'id':id,'hotelName':escape(hotelName),'roomName':escape(roomName),'price':price,'hId':hId};var roomInfo='';var roomCookieInfo=readCookie(this.compareCookieName);if($.trim(roomCookieInfo)){roomInfo=jQuery.parseJSON($.trim(roomCookieInfo));}else{roomInfo={};}
roomInfo[id]=value;createCookie(this.compareCookieName,JSON.stringify(roomInfo),1)},initCompareList:function(){var _this=this;var roomCookieInfo=readCookie(this.compareCookieName);if($.trim(roomCookieInfo)){var roomInfo=jQuery.parseJSON($.trim(roomCookieInfo));var i=0;$("#contrastList").empty();for(var key in roomInfo){if(i<2){if(roomInfo.hasOwnProperty(key)){var oneRoom=roomInfo[key];_this.showCompareRoom(oneRoom['id'],oneRoom['hotelName'],oneRoom['roomName'],oneRoom['price'],oneRoom['hId']);i++;}}}}},countObjProperties:function(obj){var prop;var propCount=0;for(prop in obj){if(obj.hasOwnProperty(prop)){propCount++;}}
return propCount;}}
var hotelRoomList={init:function(){this.hotelRoomsHover();this.roomMoreDesShow();this.showBookingTips();},hotelRoomsHover:function(){$("#main").find("li.noHouse, li.line2").live({mouseenter:function(){$(this).addClass("hover");},mouseleave:function(){$(this).removeClass("hover");}});},roomMoreDesShow:function(){var _noHouse=$(".noHouse");var _hasHouse=$(".hasHouse");_noHouse.each(function(i,n){$(n).find(".toggle_house").click(function(){$(n).hide().next(".hasHouse").show();})})
_hasHouse.each(function(i,n){$(n).find(".toggle_house").click(function(){$(n).hide().prev(".noHouse").show();})})},showBookingTips:function(){$('.icon_tip').on({mouseenter:function(){utip=$(this).next('.popTip');if(utip.length){$('.popBox').length>0?tip=$('.popBox'):tip=$('<div class="popBox"></div>').appendTo('body');tip.html(utip.html());tip.show();}},mouseleave:function(){tip=$('.popBox')
if(tip.length){tip.hide();}},mousemove:function(e){tip=$('.popBox')
if(tip.length){var mousex=e.pageX+20;var mousey=e.pageY;var tipWidth=tip.outerWidth();var tipHeight=tip.outerHeight();var tipVisX=$(window).width()-(mousex+tipWidth);var tipVisY=$(window).height()-(mousey+tipHeight);if(tipVisX<20){mousex=e.pageX-tipWidth-20;}
if(tipVisY<0){mousey=e.pageY-tipHeight;}
tip.css({top:mousey,left:mousex});}}})}}
var hotelPublic={init:function(){this.leftDivFloat();},leftDivFloat:function(){if($.browser.msie&&$.browser.version=='6.0'){return false;}
var zp_float=$('#scrollFix');if(!zp_float.length){return false;}
var zp_float_hei=zp_float.height();var fpos=zp_float.offset().top;if($("#landmark").length){var bottomOffset=$("#landmark").offset().top;}else{bottomOffset=$("#reasonBox").offset().top;}
var fixed=false;var staticed=false;var zp_float_hide=false;var zp_float_show=false;$(window).on('scroll',function(){if($('#scroll_btn').length){if(!$('#scroll_btn').hasClass('selected')){return;}}
var s_top=$(window).scrollTop();if(s_top>fpos&&!fixed){zp_float.css({'position':'fixed','z-index':100,'top':0});fixed=true;staticed=false;}else if(s_top<=fpos&&!staticed){zp_float.css({'position':'static'});staticed=true;fixed=false;}
if(bottomOffset<=s_top+zp_float_hei+20&&!zp_float_hide){zp_float.css({'position':'absolute','top':bottomOffset-fpos-zp_float_hei-20});zp_float_hide=true;zp_float_show=false;}else if(bottomOffset>s_top+zp_float_hei+20&&!zp_float_show&&s_top>fpos){zp_float.css({'position':'fixed','z-index':100,'top':0});zp_float_show=true;zp_float_hide=false;}});}}
var hotelDate={changeDate:function(){var begin_date=this.dateTransform($("#begin_date").val());var end_date=this.dateTransform($("#end_date").val());},dateTransform:function(data){if(data=='yyyy-mm-dd'){return'';}
var data_arr=data.split('-');var year=parseInt(data_arr[0]);var month=parseInt(data_arr[1]);var day=parseInt(data_arr[2]);month=month<10?'0'+month:month;day=day<10?'0'+day:day;return year+'-'+month+'-'+day;}}
function dateDiff(interval,date1,date2){var objInterval={'D':1000*60*60*24,'H':1000*60*60,'M':1000*60,'S':1000,'T':1};interval=interval.toUpperCase();var dt1=Date.parse(date1.replace(/-/g,'/'));var dt2=Date.parse(date2.replace(/-/g,'/'));try{return Math.round((dt2-dt1)/eval('(objInterval.'+interval+')'));}catch(e){return e.message;}}
function validateDateLong(b,e){var newDate=new Date();var newDateStr=GetDateStr(newDate);var $checkindateDom=b||$('#begin_date');var $checkoutdateDom=e||$('#end_date');var $checkindate=$checkindateDom.val();var $checkoutdate=$checkoutdateDom.val();if(dateDiff('D',newDateStr,$checkoutdate)>60){return false;}else if(dateDiff('D',$checkindate,$checkoutdate)>20){return false;}
return true;}
function cleanParams(s){return s.replace("'","").replace('"','').replace("<","").replace(">","").replace("/","").replace(";","").replace("@","").replace("%","").replace("*","").replace("&","");}
function cleanCityName(c){var pattern=new RegExp("^[\u4E00-\u9FA5]+$");var cs=c.split('');var rt=[];for(var i in cs){if(pattern.test(cs[i])){rt.push(cs[i]);}}
return rt.join('');}
function stopPropagation(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation();}else{e.cancelBubble=true;}}
function GetDateStr(pdate){var dd=pdate;var y=dd.getYear();y=y%100;y=((y<50)?(2000+y):(1900+y));var m=dd.getMonth()+1;var d=dd.getDate();return y+"-"+m+"-"+d;}
function readCookie(name){var nameEQ=name+"=";var ca=document.cookie.split(';');for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==' ')c=c.substring(1,c.length);if(c.indexOf(nameEQ)==0)return c.substring(nameEQ.length,c.length);}
return null;}
function createCookie(name,value,days){if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));var expires="; expires="+date.toGMTString();}
else var expires="";document.cookie=name+"="+value+expires+"; path=/";};;!function(window,undefined){"use strict";var path='',$,win,ready={getPath:function(){var js=document.scripts||document.getElementsByTagName('script'),jsPath=js[js.length-1].src;return path?path:jsPath.substring(0,jsPath.lastIndexOf("/")+1);},type:['dialog','page','iframe','loading','tips']};window.layer={v:'1.8.5',ie6:!!window.ActiveXObject&&!window.XMLHttpRequest,index:0,path:ready.getPath(),use:function(module,callback){var i=0,head=$('head')[0];var module=module.replace(/\s/g,'');var iscss=/\.css$/.test(module);var node=document.createElement(iscss?'link':'script');var id=module.replace(/\.|\//g,'');if(iscss){node.type='text/css';node.rel='stylesheet';}
node[iscss?'href':'src']=/^http:\/\//.test(module)?module:layer.path+module;node.id=id;if(!$('#'+id)[0]){head.appendChild(node);}
if(callback){if(document.all){$(node).ready(callback);}else{$(node).load(callback);}}},alert:function(msg,icon,fn,yes){var isfn=(typeof fn==='function'),conf={dialog:{msg:msg,type:icon,yes:isfn?fn:yes},area:['auto','auto']};isfn||(conf.title=fn);return $.layer(conf);},confirm:function(msg,yes,fn,no){var isfn=(typeof fn==='function'),conf={dialog:{msg:msg,type:4,btns:2,yes:yes,no:isfn?fn:no}};isfn||(conf.title=fn);return $.layer(conf);},msg:function(msg,time,parme,end){var conf={title:false,closeBtn:false,time:time===undefined?2:time,dialog:{msg:(msg===''||msg===undefined)?'&nbsp;':msg},end:end};if(typeof parme==='object'){conf.dialog.type=parme.type;conf.shade=parme.shade;conf.shift=parme.rate;}else if(typeof parme==='function'){conf.end=parme}else{conf.dialog.type=parme;}
return $.layer(conf);},load:function(parme,icon){if(typeof parme==='string'){return layer.msg(parme,icon||0,16);}else{return $.layer({time:parme,loading:{type:icon},bgcolor:icon?'#fff':'',shade:icon?[0.1,'#000']:[0],border:(icon===3||!icon)?[0]:[6,0.3,'#000'],type:3,title:['',false],closeBtn:[0,false]});}},tips:function(html,follow,parme,maxWidth,guide,style){var conf={type:4,shade:false,success:function(layero){if(!this.closeBtn){layero.find('.xubox_tips').css({'padding-right':10});}},bgcolor:'',tips:{msg:html,follow:follow}};conf.time=typeof parme==='object'?parme.time:(parme|0);parme=parme||{};conf.closeBtn=parme.closeBtn||false
conf.maxWidth=parme.maxWidth||maxWidth;conf.tips.guide=parme.guide||guide;conf.tips.style=parme.style||style;conf.tips.more=parme.more;return $.layer(conf);}};var doms=['xubox_layer','xubox_iframe','.xubox_title','.xubox_text','.xubox_page','.xubox_main'];var Class=function(setings){var that=this,config=that.config;layer.index++;that.index=layer.index;that.config=$.extend({},config,setings);that.config.dialog=$.extend({},config.dialog,setings.dialog);that.config.page=$.extend({},config.page,setings.page);that.config.iframe=$.extend({},config.iframe,setings.iframe);that.config.loading=$.extend({},config.loading,setings.loading);that.config.tips=$.extend({},config.tips,setings.tips);that.creat();};Class.pt=Class.prototype;Class.pt.config={type:0,shade:[0.3,'#000'],fix:true,move:'.xubox_title',title:'&#x4FE1;&#x606F;',offset:['','50%'],area:['310px','auto'],closeBtn:[0,true],time:0,bgcolor:'#fff',border:[6,0.3,'#000'],zIndex:19891014,maxWidth:400,dialog:{btns:1,btn:['&#x786E;&#x5B9A;','&#x53D6;&#x6D88;'],type:8,msg:'',yes:function(index){layer.close(index);},no:function(index){layer.close(index);}},page:{dom:'#xulayer',html:'',url:''},iframe:{src:'http://sentsin.com',scrolling:'auto'},loading:{type:0},tips:{msg:'',follow:'',guide:0,isGuide:true,style:['background-color:#FF9900; color:#fff;','#FF9900']},success:function(layer){},close:function(index){layer.close(index);},end:function(){}};Class.pt.space=function(html){var that=this,html=html||'',times=that.index,config=that.config,dialog=config.dialog,ico=dialog.type===-1?'':'<span class="xubox_msg xulayer_png32 xubox_msgico xubox_msgtype'+dialog.type+'"></span>',frame=['<div class="xubox_dialog">'+ico+'<span class="xubox_msg xubox_text" style="'+(ico?'':'padding-left:20px')+'">'+dialog.msg+'</span></div>','<div class="xubox_page">'+html+'</div>','<iframe scrolling="'+config.iframe.scrolling+'" allowtransparency="true" id="'+doms[1]+''+times+'" name="'+doms[1]+''+times+'" onload="this.className=\''+doms[1]+'\'" class="'+doms[1]+'" frameborder="0" src="'+config.iframe.src+'"></iframe>','<span class="xubox_loading xubox_loading_'+config.loading.type+'"></span>','<div class="xubox_tips" style="'+config.tips.style[0]+'"><div class="xubox_tipsMsg">'+config.tips.msg+'</div><i class="layerTipsG"></i></div>'],shade='',border='',zIndex=config.zIndex+times,shadeStyle='z-index:'+zIndex+'; background-color:'+config.shade[1]+'; opacity:'+config.shade[0]+'; filter:alpha(opacity='+config.shade[0]*100+');';config.shade[0]&&(shade='<div times="'+times+'" id="xubox_shade'+times+'" class="xubox_shade" style="'+shadeStyle+'"></div>');config.zIndex=zIndex;var title='',closebtn='',borderStyle="z-index:"+(zIndex-1)+";  background-color: "+config.border[2]+"; opacity:"+config.border[1]+"; filter:alpha(opacity="+config.border[1]*100+"); top:-"+config.border[0]+"px; left:-"+config.border[0]+"px;";config.border[0]&&(border='<div id="xubox_border'+times+'" class="xubox_border" style="'+borderStyle+'"></div>');if(config.maxmin&&(config.type===1||config.type===2)&&(!/^\d+%$/.test(config.area[0])||!/^\d+%$/.test(config.area[1]))){closebtn='<a class="xubox_min" href="javascript:;"><cite></cite></a><a class="xubox_max xulayer_png32" href="javascript:;"></a>';}
config.closeBtn[1]&&(closebtn+='<a class="xubox_close xulayer_png32 xubox_close'+config.closeBtn[0]+'" href="javascript:;" style="'+(config.type===4?'position:absolute; right:-3px; _right:7px; top:-4px;':'')+'"></a>');var titype=typeof config.title==='object';config.title&&(title='<div class="xubox_title" style="'+(titype?config.title[1]:'')+'"><em>'+(titype?config.title[0]:config.title)+'</em></div>');return[shade,'<div times="'+times+'" showtime="'+config.time+'" style="z-index:'+zIndex+'" id="'+doms[0]+''+times
+'" class="'+doms[0]+'">'
+'<div style="background-color:'+config.bgcolor+'; z-index:'+zIndex+'" class="xubox_main">'
+frame[config.type]
+title
+'<span class="xubox_setwin">'+closebtn+'</span>'
+'<span class="xubox_botton"></span>'
+'</div>'+border+'</div>'];};Class.pt.creat=function(){var that=this,space='',config=that.config,dialog=config.dialog,times=that.index;var page=config.page,body=$("body"),setSpace=function(html){var html=html||'';space=that.space(html);body.append($(space[0]));};switch(config.type){case 0:config.title||(config.area=['auto','auto']);$('.xubox_dialog')[0]&&layer.close($('.xubox_dialog').parents('.'+doms[0]).attr('times'));break;case 1:if(page.html!==''){setSpace('<div class="xuboxPageHtml">'+page.html+'</div>');body.append($(space[1]));}else if(page.url!==''){setSpace('<div class="xuboxPageHtml" id="xuboxPageHtml'+times+'">'+page.html+'</div>');body.append($(space[1]));$.get(page.url,function(datas){$('#xuboxPageHtml'+times).html(datas.toString());page.ok&&page.ok(datas);});}else{if($(page.dom).parents(doms[4]).length==0){setSpace();$(page.dom).show().wrap($(space[1]));}else{return;}}
break;case 3:config.title=false;config.area=['auto','auto'];config.closeBtn=['',false];$('.xubox_loading')[0]&&layer.closeLoad();break;case 4:config.title=false;config.area=['auto','auto'];config.fix=false;config.border=[0];config.tips.more||layer.closeTips();break;};if(config.type!==1){setSpace();body.append($(space[1]));}
var layerE=that.layerE=$('#'+doms[0]+times);layerE.css({width:config.area[0],height:config.area[1]});config.fix||layerE.css({position:'absolute'});if((config.type!==3||config.type!==4)){var confbtn=config.type===0?dialog:config,layerBtn=layerE.find('.xubox_botton');confbtn.btn=config.btn||dialog.btn;switch(confbtn.btns){case 0:layerBtn.html('').hide();break;case 1:layerBtn.html('<a href="javascript:;" class="xubox_yes xubox_botton1">'+confbtn.btn[0]+'</a>');break;case 2:layerBtn.html('<a href="javascript:;" class="xubox_yes xubox_botton2">'+confbtn.btn[0]+'</a>'+'<a href="javascript:;" class="xubox_no xubox_botton3">'+confbtn.btn[1]+'</a>');break;}}
if(layerE.css('left')==='auto'){layerE.hide();setTimeout(function(){layerE.show();that.set(times);},500);}else{that.set(times);}
config.time<=0||that.autoclose();that.callback();};ready.fade=function(obj,time,opa){obj.css({opacity:0}).animate({opacity:opa},time);};Class.pt.offset=function(){var that=this,config=that.config,layerE=that.layerE,laywid=layerE.outerHeight();if(config.offset[0]===''&&laywid<win.height()){that.offsetTop=(win.height()-laywid-2*config.border[0])/2;}else if(config.offset[0].indexOf("px")!=-1){that.offsetTop=parseFloat(config.offset[0]);}else{that.offsetTop=parseFloat(config.offset[0]||0)/100*win.height();}
that.offsetTop=that.offsetTop+config.border[0]+(config.fix?0:win.scrollTop());if(config.offset[1].indexOf("px")!=-1){that.offsetLeft=parseFloat(config.offset[1])+config.border[0];}else{config.offset[1]=config.offset[1]===''?'50%':config.offset[1];if(config.offset[1]==='50%'){that.offsetLeft=config.offset[1];}else{that.offsetLeft=parseFloat(config.offset[1])/100*win.width()+config.border[0];}};};Class.pt.set=function(times){var that=this;var config=that.config;var dialog=config.dialog;var page=config.page;var loading=config.loading;var layerE=that.layerE;var layerTitle=layerE.find(doms[2]);that.autoArea(times);if(config.title){if(config.type===0){layer.ie6&&layerTitle.css({width:layerE.outerWidth()});}}else{config.type!==4&&layerE.find('.xubox_close').addClass('xubox_close1');};layerE.attr({'type':ready.type[config.type]});that.offset();if(config.type!==4){if(config.shift&&!layer.ie6){if(typeof config.shift==='object'){that.shift(config.shift[0],config.shift[1]||500,config.shift[2]);}else{that.shift(config.shift,500);}}else{layerE.css({top:that.offsetTop,left:that.offsetLeft});}}
switch(config.type){case 0:layerE.find(doms[5]).css({'background-color':'#fff'});if(config.title){layerE.find(doms[3]).css({paddingTop:18+layerTitle.outerHeight()});}else{layerE.find('.xubox_msgico').css({top:8});layerE.find(doms[3]).css({marginTop:11});}
break;case 1:layerE.find(page.dom).addClass('layer_pageContent');config.shade[0]&&layerE.css({zIndex:config.zIndex+1});config.title&&layerE.find(doms[4]).css({top:layerTitle.outerHeight()});break;case 2:var iframe=layerE.find('.'+doms[1]),heg=layerE.height();iframe.addClass('xubox_load').css({width:layerE.width()});config.title?iframe.css({top:layerTitle.height(),height:heg-layerTitle.height()}):iframe.css({top:0,height:heg});layer.ie6&&iframe.attr('src',config.iframe.src);break;case 4:var layArea=[0,layerE.outerHeight()],fow=$(config.tips.follow),fowo={width:fow.outerWidth(),height:fow.outerHeight(),top:fow.offset().top,left:fow.offset().left},tipsG=layerE.find('.layerTipsG');config.tips.isGuide||tipsG.remove();layerE.outerWidth()>config.maxWidth&&layerE.width(config.maxWidth);fowo.tipColor=config.tips.style[1];layArea[0]=layerE.outerWidth();fowo.autoLeft=function(){if(fowo.left+layArea[0]-win.width()>0){fowo.tipLeft=fowo.left+fowo.width-layArea[0];tipsG.css({right:12,left:'auto'});}else{fowo.tipLeft=fowo.left;};};fowo.where=[function(){fowo.autoLeft();fowo.tipTop=fowo.top-layArea[1]-10;tipsG.removeClass('layerTipsB').addClass('layerTipsT').css({'border-right-color':fowo.tipColor});},function(){fowo.tipLeft=fowo.left+fowo.width+10;fowo.tipTop=fowo.top;tipsG.removeClass('layerTipsL').addClass('layerTipsR').css({'border-bottom-color':fowo.tipColor});},function(){fowo.autoLeft();fowo.tipTop=fowo.top+fowo.height+10;tipsG.removeClass('layerTipsT').addClass('layerTipsB').css({'border-right-color':fowo.tipColor});},function(){fowo.tipLeft=fowo.left-layArea[0]+10;fowo.tipTop=fowo.top;tipsG.removeClass('layerTipsR').addClass('layerTipsL').css({'border-bottom-color':fowo.tipColor});}];fowo.where[config.tips.guide]();if(config.tips.guide===0){fowo.top-(win.scrollTop()+layArea[1]+8*2)<0&&fowo.where[2]();}else if(config.tips.guide===1){win.width()-(fowo.left+fowo.width+layArea[0]+8*2)>0||fowo.where[3]()}else if(config.tips.guide===2){(fowo.top-win.scrollTop()+fowo.height+layArea[1]+8*2)-win.height()>0&&fowo.where[0]();}else if(config.tips.guide===3){layArea[0]+8*2-fowo.left>0&&fowo.where[1]()}else if(config.tips.guide===4){}
layerE.css({left:fowo.tipLeft,top:fowo.tipTop});break;};if(config.fadeIn){ready.fade(layerE,config.fadeIn,1);ready.fade($('#xubox_shade'+times),config.fadeIn,config.shade[0]);}
if(config.fix&&config.offset[0]===''&&!config.shift){win.on('resize',function(){layerE.css({top:(win.height()-layerE.outerHeight())/2});});}
that.move();};Class.pt.shift=function(type,rate,stop){var that=this,config=that.config;var layerE=that.layerE;var cutWth=0,ww=win.width();var wh=win.height()+(config.fix?0:win.scrollTop());if(config.offset[1]=='50%'||config.offset[1]==''){cutWth=layerE.outerWidth()/2;}else{cutWth=layerE.outerWidth();}
var anim={t:{top:that.offsetTop},b:{top:wh-layerE.outerHeight()-config.border[0]},cl:cutWth+config.border[0],ct:-layerE.outerHeight(),cr:ww-cutWth-config.border[0]};switch(type){case'left-top':layerE.css({left:anim.cl,top:anim.ct}).animate(anim.t,rate);break;case'top':layerE.css({top:anim.ct}).animate(anim.t,rate);break;case'right-top':layerE.css({left:anim.cr,top:anim.ct}).animate(anim.t,rate);break;case'right-bottom':layerE.css({left:anim.cr,top:wh}).animate(stop?anim.t:anim.b,rate);break;case'bottom':layerE.css({top:wh}).animate(stop?anim.t:anim.b,rate);break;case'left-bottom':layerE.css({left:anim.cl,top:wh}).animate(stop?anim.t:anim.b,rate);break;case'left':layerE.css({left:-layerE.outerWidth()}).animate({left:that.offsetLeft},rate);break;}};Class.pt.autoArea=function(times){var that=this,times=times||that.index,config=that.config,page=config.page;var layerE=$('#'+doms[0]+times),layerTitle=layerE.find(doms[2]),layerMian=layerE.find(doms[5]);var titHeight=config.title?layerTitle.innerHeight():0,outHeight,btnHeight=0;if(config.area[0]==='auto'&&layerMian.outerWidth()>=config.maxWidth){layerE.css({width:config.maxWidth});}
switch(config.type){case 0:var aBtn=layerE.find('.xubox_botton>a');outHeight=layerE.find(doms[3]).outerHeight()+20;if(aBtn.length>0){btnHeight=aBtn.outerHeight()+20;}
break;case 1:var layerPage=layerE.find(doms[4]);outHeight=$(page.dom).outerHeight();config.area[0]==='auto'&&layerE.css({width:layerPage.outerWidth()});if(page.html!==''||page.url!==''){outHeight=layerPage.outerHeight();}
break;case 2:layerE.find('iframe').css({width:layerE.outerWidth(),height:layerE.outerHeight()-(config.title?layerTitle.innerHeight():0)});break;case 3:var load=layerE.find(".xubox_loading");outHeight=load.outerHeight();layerMian.css({width:load.width()});break;};(config.area[1]==='auto')&&layerMian.css({height:titHeight+outHeight+btnHeight});$('#xubox_border'+times).css({width:layerE.outerWidth()+2*config.border[0],height:layerE.outerHeight()+2*config.border[0]});(layer.ie6&&config.area[0]!=='auto')&&layerMian.css({width:layerE.outerWidth()});(config.offset[1]==='50%'||config.offset[1]=='')&&(config.type!==4)?layerE.css({marginLeft:-layerE.outerWidth()/2}):layerE.css({marginLeft:0});};Class.pt.move=function(){var that=this,config=that.config,conf={setY:0,moveLayer:function(){if(parseInt(conf.layerE.css('margin-left'))==0){var lefts=parseInt(conf.move.css('left'));}else{var lefts=parseInt(conf.move.css('left'))+(-parseInt(conf.layerE.css('margin-left')))}
if(conf.layerE.css('position')!=='fixed'){lefts=lefts-conf.layerE.parent().offset().left;conf.setY=0}
conf.layerE.css({left:lefts,top:parseInt(conf.move.css('top'))-conf.setY});}};var movedom=that.layerE.find(config.move);config.move&&movedom.attr('move','ok');config.move?movedom.css({cursor:'move'}):movedom.css({cursor:'auto'});$(config.move).on('mousedown',function(M){M.preventDefault();if($(this).attr('move')==='ok'){conf.ismove=true;conf.layerE=$(this).parents('.'+doms[0]);var xx=conf.layerE.offset().left,yy=conf.layerE.offset().top,ww=conf.layerE.width()-6,hh=conf.layerE.height()-6;if(!$('#xubox_moves')[0]){$('body').append('<div id="xubox_moves" class="xubox_moves" style="left:'+xx+'px; top:'+yy+'px; width:'+ww+'px; height:'+hh+'px; z-index:2147483584"></div>');}
conf.move=$('#xubox_moves');config.moveType&&conf.move.css({opacity:0});conf.moveX=M.pageX-conf.move.position().left;conf.moveY=M.pageY-conf.move.position().top;conf.layerE.css('position')!=='fixed'||(conf.setY=win.scrollTop());}});$(document).mousemove(function(M){if(conf.ismove){var offsetX=M.pageX-conf.moveX,offsetY=M.pageY-conf.moveY;M.preventDefault();if(!config.moveOut){conf.setY=win.scrollTop();var setRig=win.width()-conf.move.outerWidth()-config.border[0],setTop=config.border[0]+conf.setY;offsetX<config.border[0]&&(offsetX=config.border[0]);offsetX>setRig&&(offsetX=setRig);offsetY<setTop&&(offsetY=setTop);offsetY>win.height()-conf.move.outerHeight()-config.border[0]+conf.setY&&(offsetY=win.height()-conf.move.outerHeight()-config.border[0]+conf.setY);}
conf.move.css({left:offsetX,top:offsetY});config.moveType&&conf.moveLayer();offsetX=null;offsetY=null;setRig=null;setTop=null}}).mouseup(function(){try{if(conf.ismove){conf.moveLayer();conf.move.remove();}
conf.ismove=false;}catch(e){conf.ismove=false;}
config.moveEnd&&config.moveEnd();});};Class.pt.autoclose=function(){var that=this,time=that.config.time,maxLoad=function(){time--;if(time===0){layer.close(that.index);clearInterval(that.autotime);}};that.autotime=setInterval(maxLoad,1000);};ready.config={end:{}};Class.pt.callback=function(){var that=this,layerE=that.layerE,config=that.config,dialog=config.dialog;that.openLayer();that.config.success(layerE);layer.ie6&&that.IE6(layerE);layerE.find('.xubox_close').on('click',function(){config.close(that.index);layer.close(that.index);});layerE.find('.xubox_yes').on('click',function(){config.yes?config.yes(that.index):dialog.yes(that.index);});layerE.find('.xubox_no').on('click',function(){config.no?config.no(that.index):dialog.no(that.index);layer.close(that.index);});if(that.config.shadeClose){$('#xubox_shade'+that.index).on('click',function(){layer.close(that.index);});}
layerE.find('.xubox_min').on('click',function(){layer.min(that.index,config);config.min&&config.min(layerE);});layerE.find('.xubox_max').on('click',function(){if($(this).hasClass('xubox_maxmin')){layer.restore(that.index);config.restore&&config.restore(layerE);}else{layer.full(that.index,config);config.full&&config.full(layerE);}});ready.config.end[that.index]=config.end;};ready.reselect=function(){$.each($('select'),function(index,value){var sthis=$(this);if(!sthis.parents('.'+doms[0])[0]){(sthis.attr('layer')==1&&$('.'+doms[0]).length<1)&&sthis.removeAttr('layer').show();}
sthis=null;});};Class.pt.IE6=function(layerE){var that=this;var _ieTop=layerE.offset().top;if(that.config.fix){var ie6Fix=function(){layerE.css({top:win.scrollTop()+_ieTop});};}else{var ie6Fix=function(){layerE.css({top:_ieTop});};}
ie6Fix();win.scroll(ie6Fix);$.each($('select'),function(index,value){var sthis=$(this);if(!sthis.parents('.'+doms[0])[0]){sthis.css('display')=='none'||sthis.attr({'layer':'1'}).hide();}
sthis=null;});};Class.pt.openLayer=function(){var that=this,layerE=that.layerE;layer.autoArea=function(index){return that.autoArea(index);};layer.shift=function(type,rate,stop){that.shift(type,rate,stop);};layer.setMove=function(){return that.move();};layer.zIndex=that.config.zIndex;layer.setTop=function(layerNow){var setZindex=function(){layer.zIndex++;layerNow.css('z-index',layer.zIndex+1);};layer.zIndex=parseInt(layerNow[0].style.zIndex);layerNow.on('mousedown',setZindex);return layer.zIndex;};};ready.isauto=function(layero,options,offset){options.area[0]==='auto'&&(options.area[0]=layero.outerWidth());options.area[1]==='auto'&&(options.area[1]=layero.outerHeight());layero.attr({area:options.area+','+offset});layero.find('.xubox_max').addClass('xubox_maxmin');};ready.rescollbar=function(index){if(doms.html.attr('layer-full')==index){if(doms.html[0].style.removeProperty){doms.html[0].style.removeProperty('overflow');}else{doms.html[0].style.removeAttribute('overflow');}
doms.html.removeAttr('layer-full');}};layer.getIndex=function(selector){return $(selector).parents('.'+doms[0]).attr('times');};layer.getChildFrame=function(selector,index){index=index||$('.'+doms[1]).parents('.'+doms[0]).attr('times');return $('#'+doms[0]+index).find('.'+doms[1]).contents().find(selector);};layer.getFrameIndex=function(name){return $(name?'#'+name:'.'+doms[1]).parents('.'+doms[0]).attr('times');};layer.iframeAuto=function(index){index=index||$('.'+doms[1]).parents('.'+doms[0]).attr('times');var heg=layer.getChildFrame('body',index).outerHeight(),layero=$('#'+doms[0]+index),tit=layero.find(doms[2]),titHt=0;tit&&(titHt=tit.height());layero.css({height:heg+titHt});var bs=-parseInt($('#xubox_border'+index).css('top'));$('#xubox_border'+index).css({height:heg+2*bs+titHt});$('#'+doms[1]+index).css({height:heg});};layer.iframeSrc=function(index,url){$('#'+doms[0]+index).find('iframe').attr('src',url);};layer.area=function(index,options){var layero=[$('#'+doms[0]+index),$('#xubox_border'+index)],type=layero[0].attr('type'),main=layero[0].find(doms[5]),title=layero[0].find(doms[2]);if(type===ready.type[1]||type===ready.type[2]){layero[0].css(options);main.css({width:options.width,height:options.height});if(type===ready.type[2]){var iframe=layero[0].find('iframe');iframe.css({width:options.width,height:title?options.height-title.innerHeight():options.height});}
if(layero[0].css('margin-left')!=='0px'){options.hasOwnProperty('top')&&layero[0].css({top:options.top-(layero[1][0]?parseFloat(layero[1].css('top')):0)});options.hasOwnProperty('left')&&layero[0].css({left:options.left+layero[0].outerWidth()/2-(layero[1][0]?parseFloat(layero[1].css('left')):0)});layero[0].css({marginLeft:-layero[0].outerWidth()/2});}
if(layero[1][0]){layero[1].css({width:parseFloat(options.width)-2*parseFloat(layero[1].css('left')),height:parseFloat(options.height)-2*parseFloat(layero[1].css('top'))});}}};layer.min=function(index,options){var layero=$('#'+doms[0]+index),offset=[layero.position().top,layero.position().left+parseFloat(layero.css('margin-left'))];ready.isauto(layero,options,offset);layer.area(index,{width:180,height:35});layero.find('.xubox_min').hide();layero.attr('type')==='page'&&layero.find(doms[4]).hide();ready.rescollbar(index);};layer.restore=function(index){var layero=$('#'+doms[0]+index),area=layero.attr('area').split(',');var type=layero.attr('type');layer.area(index,{width:parseFloat(area[0]),height:parseFloat(area[1]),top:parseFloat(area[2]),left:parseFloat(area[3])});layero.find('.xubox_max').removeClass('xubox_maxmin');layero.find('.xubox_min').show();layero.attr('type')==='page'&&layero.find(doms[4]).show();ready.rescollbar(index);};layer.full=function(index,options){var layero=$('#'+doms[0]+index),borders=options.border[0]*2||6,timer;var offset=[layero.position().top,layero.position().left+parseFloat(layero.css('margin-left'))];ready.isauto(layero,options,offset);if(!doms.html.attr('layer-full')){doms.html.css('overflow','hidden').attr('layer-full',index);}
clearTimeout(timer);timer=setTimeout(function(){layer.area(index,{top:layero.css('position')==='fixed'?0:win.scrollTop(),left:layero.css('position')==='fixed'?0:win.scrollLeft(),width:win.width()-borders,height:win.height()-borders});},100);};layer.title=function(name,index){var title=$('#'+doms[0]+(index||layer.index)).find('.xubox_title>em');title.html(name);};layer.close=function(index){var layero=$('#'+doms[0]+index),type=layero.attr('type'),shadeNow=$('#xubox_moves, #xubox_shade'+index);if(!layero[0]){return;}
if(type==ready.type[1]){if(layero.find('.xuboxPageHtml')[0]){layero[0].innerHTML='';layero.remove();}else{layero.find('.xubox_setwin,.xubox_close,.xubox_botton,.xubox_title,.xubox_border').remove();for(var i=0;i<3;i++){layero.find('.layer_pageContent').unwrap().hide();}}}else{layero[0].innerHTML='';layero.remove();}
shadeNow.remove();layer.ie6&&ready.reselect();ready.rescollbar(index);typeof ready.config.end[index]==='function'&&ready.config.end[index]();delete ready.config.end[index];};layer.closeLoad=function(){layer.close($('.xubox_loading').parents('.'+doms[0]).attr('times'));};layer.closeTips=function(){layer.closeAll('tips');};layer.closeAll=function(type){$.each($('.'+doms[0]),function(){var othis=$(this);var is=type?(othis.attr('type')===type):1;if(is){layer.close(othis.attr('times'));}
is=null;});};ready.run=function(){$=jQuery;win=$(window);doms.html=$('html');$.layer=function(deliver){var o=new Class(deliver);return o.index;};};if("function"===typeof define){define('layer',function(){ready.run();return layer;});}else{ready.run();}}(window);;(function($){$.fn.jCarouselLite=function(o){o=$.extend({btnPrev:null,btnNext:null,btnGo:null,mouseWheel:false,auto:null,speed:200,easing:null,vertical:false,circular:true,visible:3,start:0,scroll:1,beforeStart:null,afterEnd:null},o||{});return this.each(function(){var b=false,animCss=o.vertical?"top":"left",sizeCss=o.vertical?"height":"width";var c=$(this),ul=$("ul",c),tLi=$("li",ul),tl=tLi.size(),v=o.visible;if(o.circular){ul.prepend(tLi.slice(tl-v-1+1).clone()).append(tLi.slice(0,v).clone());o.start+=v}
var f=$("li",ul),itemLength=f.size(),curr=o.start;c.css("visibility","visible");f.css({overflow:"hidden",float:o.vertical?"none":"left"});ul.css({margin:"0",padding:"0",position:"relative","list-style-type":"none","z-index":"1"});c.css({overflow:"hidden",position:"relative","z-index":"2",left:"0px"});var g=o.vertical?height(f):width(f);var h=g*itemLength;var j=g*v;f.css({width:f.width(),height:f.height()});ul.css(sizeCss,h+"px").css(animCss,-(curr*g));c.css(sizeCss,j+"px");if(o.btnPrev)$(o.btnPrev).click(function(){return go(curr-o.scroll)});if(o.btnNext)$(o.btnNext).click(function(){return go(curr+o.scroll)});if(o.btnGo)$.each(o.btnGo,function(i,a){$(a).click(function(){return go(o.circular?o.visible+i:i)})});if(o.mouseWheel&&c.mousewheel)c.mousewheel(function(e,d){return d>0?go(curr-o.scroll):go(curr+o.scroll)});if(o.auto)setInterval(function(){go(curr+o.scroll)},o.auto+o.speed);function vis(){return f.slice(curr).slice(0,v)};function go(a){if(!b){if(o.beforeStart)o.beforeStart.call(this,vis());if(o.circular){if(a<=o.start-v-1){ul.css(animCss,-((itemLength-(v*2))*g)+"px");curr=a==o.start-v-1?itemLength-(v*2)-1:itemLength-(v*2)-o.scroll}else if(a>=itemLength-v+1){ul.css(animCss,-((v)*g)+"px");curr=a==itemLength-v+1?v+1:v+o.scroll}else curr=a}else{if(a<0||a>itemLength-v)return;else curr=a}
b=true;ul.animate(animCss=="left"?{left:-(curr*g)}:{top:-(curr*g)},o.speed,o.easing,function(){if(o.afterEnd)o.afterEnd.call(this,vis());b=false});if(!o.circular){$(o.btnPrev+","+o.btnNext).removeClass("disabled");$((curr-o.scroll<0&&o.btnPrev)||(curr+o.scroll>itemLength-v&&o.btnNext)||[]).addClass("disabled")}}
return false}})};function css(a,b){return parseInt($.css(a[0],b))||0};function width(a){return a[0].offsetWidth+css(a,'marginLeft')+css(a,'marginRight')};function height(a){return a[0].offsetHeight+css(a,'marginTop')+css(a,'marginBottom')}})(jQuery);;var allPhotos_g=null;var photoNumPerPage_g=16;var userCommentNumPerPage_g=25;var userCommentAmount_g=0;var userCommentAmountAll_g=0;var ajaxData_g={'hotelId':'','productId':''};(function ghostInit(){var GhostImage;GhostImage={el:new Image,width:400,height:300};GhostImage.el.style.cssText='position: fixed; z-index: 5; display: none; padding: 2px; border: 1px solid #e6e6e6; background: #fff; width: {{width}}px; height: {{height}}px;'.replace(/{{(\w+)}}/,function($,$1){return GhostImage[$1];});function Ghost(el){this.el=el;this.$el=$(el);this.init();}
_.extend(Ghost.prototype,{init:function(){this.mouseover=_.bind(this.mouseover,this);this.mousemove=_.bind(this.mousemove,this);this.addEvents();},addEvents:function(){this.$el.on('mouseover',this.mouseover);},mouseover:function(){this.$el.off('mouseover',this.mouseover);$(document).on('mousemove',this.mousemove);GhostImage.el.src=this.$el.data('bigpic');document.body.appendChild(GhostImage.el);this.showTimeout=window.setTimeout(function(){GhostImage.el.style.display='';},500);},mousemove:function(e){var clientX,clientY,beyondBounding,captureRect;clientX=e.clientX;clientY=e.clientY;beyondBounding=false;captureRect=this.el.getBoundingClientRect();if(clientX<captureRect.left||clientX>captureRect.right){beyondBounding=true;}else if(clientY<captureRect.top||clientY>captureRect.bottom){beyondBounding=true;}
if(beyondBounding){$(document).off('mousemove',this.mousemove);this.$el.on('mouseover',this.mouseover);GhostImage.el.style.display='none';window.clearTimeout(this.showTimeout);var $el=$(GhostImage.el);if($el.parents('document.body').length!=0){document.body.removeChild(GhostImage.el);}}else{this.adjustPosition(e.clientX,e.clientY);}},adjustPosition:function(clientX,clientY){var x,y;x=clientX+12;y=clientY+12;y=Math.min(y,document.documentElement.clientHeight-GhostImage.height);y=Math.max(0,y);x=Math.min(x,document.documentElement.clientWidth-GhostImage.width);x=Math.max(0,x);GhostImage.el.style.left=x+'px';GhostImage.el.style.top=y+'px';}});$.fn.ghost=function(){var ghostMultiObjs=this;$(ghostMultiObjs).each(function(){var ghostSingleObj=this;new Ghost(ghostSingleObj);});};})();var search={setKeyword:function(val){searchObj.model.keyword=val;},setCheckInDate:function(dateStr){dateStr=Date.formatDateStr(dateStr,'/','-');searchObj.model.checkInDate=dateStr;},setCheckOutDate:function(dateStr){dateStr=Date.formatDateStr(dateStr,'/','-');searchObj.model.checkOutDate=dateStr;},headDayBeyondCheck:function(){var checkInDate=$('#begin_date').val();var $end_date=$('#end_date');var checkOutDate=$end_date.val();if(Date.diff('D',checkInDate,checkOutDate)>28){$('#headDayBeyond').css('display','block');if(!$end_date.hasClass('date_beyond_error_border')){$end_date.addClass('date_beyond_error_border');}}else{$('#headDayBeyond').css('display','none');if($end_date.hasClass('date_beyond_error_border')){$end_date.removeClass('date_beyond_error_border');}}},priceDayBeyondCheck:function(){var checkInDate=$('#J_begin_date').val();var $J_end_date=$('#J_end_date');var checkOutDate=$J_end_date.val();if(Date.diff('D',checkInDate,checkOutDate)>28){$('#priceDayBeyond').css('display','block');if(!$J_end_date.hasClass('date_beyond_error_border')){$J_end_date.addClass('date_beyond_error_border');}}else{$('#priceDayBeyond').css('display','none');if($J_end_date.hasClass('date_beyond_error_border')){$J_end_date.removeClass('date_beyond_error_border');}}}};var searchObj={model:{cityCode:0,cityName:'',checkInDate:'',checkOutDate:'',keyword:''},initialize:function(){this.$city=$('#txtCity');this.$beginDate=$('#begin_date');this.$endDate=$('#end_date');this.$keyword=$('#keyWord');this.$J_beginDate=$('#J_begin_date');this.$J_endDate=$('#J_end_date');this.fetchData();this.addEvents();},save:function(){var begin_date,end_date,expires_date;begin_date=searchObj.$beginDate.val();end_date=searchObj.$endDate.val();expires_date=new Date();expires_date.setDate(expires_date.getDate()+7);expires_date=expires_date.toString();var J_begin_date,J_end_date,J_expires_date;J_begin_date=searchObj.$J_beginDate.val();J_end_date=searchObj.$J_endDate.val();J_expires_date=new Date();J_expires_date.setDate(J_expires_date.getDate()+7);J_expires_date=J_expires_date.toString();},fetchData:function(){var $city,$beginDate,$endDate,$keyword,keyword,keywordPlaceHolder;$city=this.$city;$beginDate=this.$beginDate;$endDate=this.$endDate;$keyword=this.$keyword;keyword=$keyword.val();keywordPlaceHolder=$keyword.data('placeholder');keyword=keyword===keywordPlaceHolder?'':keyword;this.model={cityCode:+$city.attr('code'),cityName:$city.val(),checkInDate:$beginDate.val(),checkOutDate:$endDate.val(),keyword:keyword};},addEvents:function(){var view=this;$('#search_hotel').on('click',search.headDayBeyondCheck);$('#search_hotel').on('click',this.save);$('#hotelPriceScanPrice').on('click',this.save);$('#hotelPriceScanPrice').on('click',search.priceDayBeyondCheck);$('#begin_date, #end_date').TN_date({wrap:$('body'),onSelect:function(dateStr,$target){if($target.is('#begin_date')){search.setCheckInDate(dateStr);}else{search.setCheckOutDate(dateStr);}
var selectedEndDate=dateStr;var beginDate=$('#begin_date').val();var $end_date=$('#end_date');if(Date.diff('D',beginDate,selectedEndDate)>28){$('#headDayBeyond').css('display','block');if(!$end_date.hasClass('date_beyond_error_border')){$end_date.addClass('date_beyond_error_border');}}else{$('#headDayBeyond').css('display','none');if($end_date.hasClass('date_beyond_error_border')){$end_date.removeClass('date_beyond_error_border');}}}});$('#J_begin_date,#J_end_date').TN_date({wrap:$("body"),dateW:'tnDateW',tnStartDate:'date_t_pre',tnEndDate:'date_t_next',onSelect:function(dateStr,$target){if($target.is('#J_begin_date')){search.setCheckInDate(dateStr);}else{search.setCheckOutDate(dateStr);}
var selectedEndDate=dateStr;var beginDate=$('#J_begin_date').val();var $J_end_date=$('#J_end_date');if(Date.diff('D',beginDate,selectedEndDate)>28){$('#priceDayBeyond').css('display','block');if(!$J_end_date.hasClass('date_beyond_error_border')){$J_end_date.addClass('date_beyond_error_border');}}else{$('#priceDayBeyond').css('display','none');if($J_end_date.hasClass('date_beyond_error_border')){$J_end_date.removeClass('date_beyond_error_border');}}}});this.$keyword.on('change',function(e,name){var keyword,placeholder,$this;$this=$(this);keyword=$this.val();placeholder=$this.data('placeholder');keyword=keyword===placeholder?'':keyword;search.setKeyword(keyword);});}};function GetAndSet(option){var url=option.url,data=option.data,async=option.async,beforeSend=option.beforeSend,successfunc=option.successfunc,errorfunc=option.errorfunc,completefunc=option.completefunc,timeout=option.timeout;if(typeof(async)==undefined||!async||async==null){async=true;}else if(async==true){async=false;}
if(typeof(timeout)==undefined||!timeout||timeout==null){timeout=300000;}else{}
$.ajax({url:url,data:data,type:"post",global:true,timeout:timeout,async:async,beforeSend:function(XMLHttpRequest){if(beforeSend&&typeof beforeSend==='function'){beforeSend();}},complete:function(XMLHttpRequest){if(completefunc&&typeof completefunc==='function'){completefunc();}},success:function(data){if(successfunc&&typeof successfunc==='function'){successfunc(data);}},error:function(XMLHttpRequest){if(errorfunc&&typeof errorfunc==='function'){errorfunc();}}})};var PhotoPagesObj={pageAmount:0,currentPage:0,imagePageData:function(page){PhotoPagesObj.currentPage=page;PhotoPagesObj.getImageData(page);},getImageData:function(page){PhotoPagesObj.imagesPage(page,PhotoPagesObj.pageAmount);var tabId=$('#environmentTab .sel_cur').attr('id');hotelPhotoLoadInit(tabId,page);},imagesPage:function(curPage,pageNum){if(!pageNum)
pageNum=1;var pagerHtml='';var photoPages;if(curPage==1){pagerHtml+='<span class="page-start">上一页</span>';}else{photoPages=curPage-1;pagerHtml+='<a href="javascript:void(0)" onclick="PhotoPagesObj.imagePageData('+photoPages+')" class="page-prev">上一页</a>';}
if(curPage>5){photoPages=1;pagerHtml+='<a href="javascript:void(0)" onclick="PhotoPagesObj.imagePageData('+photoPages+')">1</a><span class="page-break">...</span>';}else if(curPage==1){pagerHtml+='<span class="page-cur">1</span>';}else{photoPages=1;pagerHtml+='<a href="javascript:void(0)" onclick="PhotoPagesObj.imagePageData('+photoPages+')">1</a>';}
var start=curPage-3;var end=curPage+2;start=(start>2)?start:2;end=(end<(pageNum-1))?end:(pageNum-1);for(var i=start;i<=end;i++){if(i==curPage){pagerHtml+='<span class="page-cur">'+i+'</span>';}else{photoPages=i;pagerHtml+='<a href="javascript:void(0)" onclick="PhotoPagesObj.imagePageData('+photoPages+')">'+i+'</a>';}}
if(pageNum!=1){if(curPage+4<=pageNum){photoPages=pageNum;pagerHtml+='<span class="page-break">...</span><a href="javascript:void(0)" onclick="PhotoPagesObj.imagePageData('+photoPages+')">'+pageNum+'</a>';}else if(curPage==pageNum){pagerHtml+='<span class="page-cur">'+pageNum+'</span>';}else{photoPages=pageNum;pagerHtml+='<a href="javascript:void(0)" onclick="PhotoPagesObj.imagePageData('+photoPages+')">'+pageNum+'</a>';}}
if(curPage==pageNum){pagerHtml+='<span class="page-end">下一页</span>';}else{photoPages=curPage+1;pagerHtml+='<a href="javascript:void(0)" onclick="PhotoPagesObj.imagePageData('+photoPages+')" class="page-next">下一页</a>';}
$('#imagesPage').html(pagerHtml);}};var remarkPagesObj={pageAmount:0,getRemarkData:function(page,group){remarksPage(page,'remarkPagesObj',remarkPagesObj.pageAmount);$('.user_remark_datail .u5').remove();$('#hotelUserCommentBodyLoading').show();var pos=$("#userCommentPic").offset().top;$("html,body").animate({scrollTop:pos},400);var postData='hotelId='+ajaxData_g.hotelId+'&p='+page+'&group='+group;GetAndSet({url:'/ajax/remarkQuery?'+postData,successfunc:function(data){$('.user_remark_datail').html(data);$('#hotelUserCommentBodyLoading').hide();$('.comment_pic').ghost();$(".rollpicshow").each(function(){var length=$(this).children().children().length;$(this).jCarouselLite({btnNext:"#"+$(this).prev().attr('id'),btnPrev:"#"+$(this).next().attr('id'),visible:length>6?6:length});});var pages=parseInt($('.concludeAll.cur').attr('data-count')/20)+1;var groupPagesObj={};groupPagesObj.pageAmount=pages;groupPagesObj.group=group;remarksPage(1,'groupPagesObj',pages);},errorfunc:function(){}});}};var groupPagesObj={pageAmount:parseInt($('.concludeAll.cur').attr('data-count')/20)+1,group:$('.concludeAll.cur').attr('data'),getRemarkData:function(page){$('.user_remark_datail .u5').remove();$('#hotelUserCommentBodyLoading').show();var pos=$("#userCommentPic").offset().top;$("html,body").animate({scrollTop:pos},400);var postData='hotelId='+ajaxData_g.hotelId+'&group='+$('.concludeAll.cur').attr('data')+'&p='+page;GetAndSet({url:'/ajax/remarkQuery?'+postData,successfunc:function(data){$('.user_remark_datail').html(data);$('#hotelUserCommentBodyLoading').hide();$('.comment_pic').ghost();$(".rollpicshow").each(function(){var length=$(this).children().children().length;$(this).jCarouselLite({btnNext:"#"+$(this).prev().attr('id'),btnPrev:"#"+$(this).next().attr('id'),visible:length>6?6:length});});remarksPage(page,'groupPagesObj',parseInt($('.concludeAll.cur').attr('data-count')/20)+1);},errorfunc:function(){}});}};var sellingPointPagesObj={pageAmount:0,sellingpointId:0,getRemarkData:function(page){remarksPage(page,'sellingPointPagesObj',sellingPointPagesObj.pageAmount);$('.user_remark_datail .u5').remove();$('#hotelUserCommentBodyLoading').show();var pos=$("#userCommentPic").offset().top;$("html,body").animate({scrollTop:pos},400);var postData='hotelId='+ajaxData_g.hotelId+'&sellingpointId='+this.sellingpointId+'&p='+page;GetAndSet({url:'/ajax/remarkQuery?'+postData,successfunc:function(data){$('.user_remark_datail').html(data);$('#hotelUserCommentBodyLoading').hide();$('.comment_pic').ghost();$(".rollpicshow").each(function(){var length=$(this).children().children().length;$(this).jCarouselLite({btnNext:"#"+$(this).prev().attr('id'),btnPrev:"#"+$(this).next().attr('id'),visible:length>6?6:length});});},errorfunc:function(){}});}};function remarksPage(curPage,PagesObj,pageNum){if(!pageNum)
pageNum=1;var pagerHtml='';var remarkPages;if(curPage==1){pagerHtml+='<span class="page-start">上一页</span>';}else{remarkPages=curPage-1;pagerHtml+='<a href="javascript:void(0)" onclick="'+PagesObj+'.getRemarkData('+remarkPages+')" class="page-prev">上一页</a>';}
if(curPage>5){remarkPages=1;pagerHtml+='<a href="javascript:void(0)" onclick="'+PagesObj+'.getRemarkData('+remarkPages+')">1</a><span class="page-break">...</span>';}else if(curPage==1){pagerHtml+='<span class="page-cur">1</span>';}else{remarkPages=1;pagerHtml+='<a href="javascript:void(0)" onclick="'+PagesObj+'.getRemarkData('+remarkPages+')">1</a>';}
var start=curPage-3;var end=curPage+2;start=(start>2)?start:2;end=(end<(pageNum-1))?end:(pageNum-1);for(var i=start;i<=end;i++){if(i==curPage){pagerHtml+='<span class="page-cur">'+i+'</span>';}else{remarkPages=i;pagerHtml+='<a href="javascript:void(0)" onclick="'+PagesObj+'.getRemarkData('+remarkPages+')">'+i+'</a>';}}
if(pageNum!=1){if(curPage+4<=pageNum){remarkPages=pageNum;pagerHtml+='<span class="page-break">...</span><a href="javascript:void(0)" onclick="'+PagesObj+'.getRemarkData('+remarkPages+')">'+pageNum+'</a>';}else if(curPage==pageNum){pagerHtml+='<span class="page-cur">'+pageNum+'</span>';}else{remarkPages=pageNum;pagerHtml+='<a href="javascript:void(0)" onclick="'+PagesObj+'.getRemarkData('+remarkPages+')">'+pageNum+'</a>';}}
if(curPage==pageNum){pagerHtml+='<span class="page-end">下一页</span>';}else{remarkPages=curPage+1;pagerHtml+='<a href="javascript:void(0)" onclick="'+PagesObj+'.getRemarkData('+remarkPages+')" class="page-next">下一页</a>';}
$('#remarksPage').html(pagerHtml);}
var remarkRelateFunc={init:function(){this.response();},calPos:function(target){var h=target.outerHeight();var cssObj={top:h+2+'px',left:'5px'};return cssObj;},response:function(){var self=this;$(document).delegate('.tradeoffDiv .tradeoff','click',function(){$(this).addClass('cur').siblings().removeClass('cur');$('.aspectDetailProsCons .aspectDetail').eq($(this).index()).show().siblings().hide();});$(document).delegate('.tradeoffConclude .concludeAll','click',function(){$(this).addClass('cur').siblings().removeClass('cur');});$(document).delegate('.concludeAll','click',function(){$('.concludePoint').hide();var group=$(this).attr('data');remarkPagesObj.getRemarkData(1,group);});$(document).delegate('.aspectOne .sellingPoint','hover',function(){$(this).find('.pointHint').css(self.calPos($(this))).toggle();});$(document).delegate('.sellingPoint','click',function(){var hotelId=$("#hotelId").val();var sellingpointId=$(this).attr('data');if($(this).find('.pointHint').length){$('.concludePoint .pointName').text($(this).find('.pointHint').text());}
else{$('.concludePoint .pointName').text($(this).find('.pointName').text());}
$('.concludePoint .pointCount').text($(this).find('.pointCount').text());$('.concludePoint').show();$('.user_remark_datail .u5').remove();$('#remarksPage').html('');$('#hotelUserCommentBodyLoading').show();$.ajax({url:'/ajax/remarkQuery',type:'get',data:{'hotelId':hotelId,'sellingpointId':sellingpointId,'p':1},success:function(s){$('#hotelUserCommentBodyLoading').hide();$('.user_remark_datail').html(s);$('.comment_pic').ghost();$(".rollpicshow").each(function(){var length=$(this).children().children().length;$(this).jCarouselLite({btnNext:"#"+$(this).prev().attr('id'),btnPrev:"#"+$(this).next().attr('id'),visible:length>6?6:length});});var pages=parseInt($('input[name="sellingPointPages"]').val(),10);sellingPointPagesObj.pageAmount=pages;sellingPointPagesObj.sellingpointId=sellingpointId;remarksPage(1,'sellingPointPagesObj',pages);}});});}}
function hotelPhotoLoadInit(type,page){var beginSeq=(page-1)*photoNumPerPage_g;var endSeq=page*photoNumPerPage_g;var src='';var htmlTxt='';var photoNum=0;var name=$('#hotelName').text()+'图片';_.each(allPhotos_g,function(e,i,l){if(type=='all'||type==e.groupEn){photoNum+=1;if(photoNum>beginSeq&&photoNum<=endSeq){src=e.big;htmlTxt+='<li><img src='+src+' alt="'+name+'"/></li>';}}});var $hotelPhotoPanel=$('#hotelPhotoPanel');$hotelPhotoPanel.html(htmlTxt);}
var top_g=0;var imgObj_g={};var WindowClientWidthCtrl={init:function(){this.addEvents();},addEvents:function(){if(window.addEventListener){window.addEventListener('resize',this.resizeWindow,false);}else if(window.attachEvent){window.attachEvent('onresize',this.resizeWindow);}else{window.onresize=this.resizeWindow;}},resizeWindow:function(){var detailsWidth,rightScrollRight;if(document.documentElement.clientWidth>=1200){if(document.body.className.indexOf('index1200')===-1){document.body.className+=' index1200';}
detailsWidth='938px';rightScrollRight='50px';}else{document.body.className=document.body.className.replace(/index1200/g,'').replace(/\s+/g,' ').replace(/(^\s+|\s+$)/g,'');detailsWidth='983px';rightScrollRight=0;}
$('#details').css('width',detailsWidth);var $rightScroll=$('#right_scroll');if($rightScroll.length!=0){$('#right_scroll').css('right',rightScrollRight);}}};var calendarWrap={init:function(){var b_date=$('#begin_date').val();var e_date=$('#end_date').val();$('#inDateWeek').text(this.getWeekday(b_date));$('#outDateWeek').text(this.getWeekday(e_date));},linkage:function(){var b_date=$('#J_begin_date').val();var e_date=$('#J_end_date').val();$('#begin_date').val(b_date);$('#end_date').val(e_date);$('#inDateWeek').text(this.getWeekday(b_date));$('#outDateWeek').text(this.getWeekday(e_date));},getWeekday:function(sDate){var dt=new Date(sDate.replace(/-/g,'/'));var todayDate=new Date();var strArr1=GetDateStr(todayDate,0).split('-');var strArr2=GetDateStr(dt,0).split('-');var str11=new Date(strArr1[0],strArr1[1]-1,strArr1[2]);var str22=new Date(strArr2[0],strArr2[1]-1,strArr2[2]);var a=['星期日','星期一','星期二','星期三','星期四','星期五','星期六'];var result=(str22-str11)/3600000;switch(result){case 0:return"今天";break;case 24:return"明天";break;case 48:return"后天";break;default:return a[dt.getDay()];}}};var styleCtrl={init:function(){styleCtrl.hotelTitle=$('.J_nameAndIcon span:eq(0)').text();styleCtrl.hotelTitleCtrl();$('#hotelPrice').addClass('clearfix');},hotelTitleCtrl:function(){var $spanTitle=$('.J_nameAndIcon span:eq(0)'),$spanIcon=$('.J_nameAndIcon span:eq(1)'),titleText=styleCtrl.hotelTitle;$spanTitle.attr('title',titleText);if(document.documentElement.clientWidth>=1200){if(titleText.length>=24){$spanTitle.text(titleText.substr(0,21)+'...');}else{$spanTitle.text(styleCtrl.hotelTitle);}}else{if(titleText.length>=16){$spanTitle.text(titleText.substr(0,15)+'...');}else{$spanTitle.text(styleCtrl.hotelTitle);}}},hotelItemZIndex:function(){var $hotelPriceListItem=$('.hotel_price_list .s2 .item'),$hotelPriceList=$('.hotel_price_list'),i,len;for(i=0,len=$hotelPriceListItem.length;i<len;i++){$($hotelPriceListItem[i]).css({'z-index':len-i,'position':'relative'});}
for(i=0,len=$hotelPriceList.length;i<len;i++){$($hotelPriceList[i]).css({'z-index':len-i,'position':'relative'});}}}
$(function(){calendarWrap.init();hotelSearchBox.init();styleCtrl.init();(function remarkinit(){var $hotelUserCommentWrap=$('#hotelUserCommentWrap');if($hotelUserCommentWrap){$hotelUserCommentWrap.remove();}
userCommentAmount_g=parseInt($('[name=remarkNum]').val(),10);if(userCommentAmount_g){var pages=parseInt($('[name=hotelRemarkPages]').val(),10);remarkPagesObj.pageAmount=pages;remarksPage(1,'remarkPagesObj',pages);}else{$("#hotelUserComment").hide();$("#mainTab .hotelUserCommentTab").hide();}})();remarkRelateFunc.init();function browserResize(){styleCtrl.hotelTitleCtrl();}
(function resizeEventBind(){if(window.addEventListener){window.addEventListener('resize',browserResize,false);}else if(window.attachEvent){window.attachEvent('onresize',browserResize);}else{window.onresize=browserResize;}})();var $hotelAddress=$('#hotelAddress');var $hotelArround=$('#hotelArround');var maxHotelAddressWidth=$('.addressInfo').width();var hotelAddressWidth=0;var hotelArroundWidth=0;if($hotelAddress.is(':visible')){hotelAddressWidth=$hotelAddress.width();}
if($hotelArround.is(':visible')){hotelArroundWidth=$hotelArround.width();}
if(hotelAddressWidth+hotelArroundWidth>=maxHotelAddressWidth){hotelAddressWidth=maxHotelAddressWidth-hotelArroundWidth-10;if($hotelAddress.is(':visible')){$hotelAddress.width(hotelAddressWidth);$hotelAddress.css({'overflow':'hidden','text-overflow':'ellipsis','white-space':'nowrap'})
$hotelAddress.attr('title',$.trim($hotelAddress.text()));}
if($hotelArround.is(':visible')){$hotelArround.css({'overflow':'hidden'})}}
(function initUI($){var hotelId=$("#hotelId").val();var productId=$("#hotel_product_id").val();var checkindate=$('#J_begin_date').val();var checkoutdate=$('#J_end_date').val();var postData='id='+hotelId+'&checkindate='+checkindate+'&checkoutdate='+checkoutdate;GetAndSet({url:'/ajax/hotelRooms?'+postData,successfunc:function(data){$('#hotelPriceBody').html(data);$('#hotelPriceBodyLoading').addClass('none');priceList.init();priceList.hotelPriceSearchEventBind();searchObj.initialize();styleCtrl.hotelItemZIndex();},errorfunc:function(){}});var pictures=HotelPictures.home.main;firtPageImagesLoad(pictures);allPhotos_g=pictures;hotelPhotoLoadInit('all',1);hotelPhotoHeaderInit();photoPaginationInit();if(allPhotos_g.length){$('#mainTab li:eq(3) strong').text('（'+allPhotos_g.length+'）');}})(jQuery);var priceList={_gaq:_gaq||[],init:function(){this.hotelPriceEventBind();this.priceCalendas();this.updateStartPrice();this.filtersRender();this.makeBorderBottomNone();},makeBorderBottomNone:function(){var hotelAmount=$('.J_hotelPriceList').length,prefix='hotelInfo',hotelInfo,$items;for(var i=0;i<hotelAmount;i++){hotelInfo=prefix+i;$items=$('#'+hotelInfo).siblings('.item');$($items[$items.length-1]).css('border-bottom','none');}},getSection:function(flag){var $hotelPriceBody=$('#hotelPriceBody');var bedType=$('#bedType_name').attr('data');var breakfast=$('#breakfast_name').attr('data');var network=$('#network_name').attr('data');var cancel=$('#cancel_name').attr('data');if($hotelPriceBody){$hotelPriceBody.empty();}
$('#hotelPriceBodyLoading').removeClass('none');var hotelId=$('#hotelId').val();var checkindate=$('#J_begin_date').val();var checkoutdate=$('#J_end_date').val();var postData='id='+hotelId+'&checkindate='+checkindate+'&checkoutdate='+checkoutdate;if(!flag){var isCashBackPrice=$('#specialSort #e').hasClass('on')?1:0;var instantConfirm=$('#specialSort .instant-confirmation').hasClass('on')?1:0;var promoting=$('#specialSort .promotion').hasClass('on')?1:0;var hourRoom=$('#specialSort .hour-room').hasClass('on')?1:0;var prePay=$('#specialSort .prePay').hasClass('on')?1:0;postData+='&isCashBackPrice='+isCashBackPrice+'&instantConfirm='+instantConfirm+'&promoting='+promoting+'&hourRoom='+hourRoom+'&prePay='+prePay
+'&bedType='+bedType+'&breakfast='+breakfast+'&network='+network+'&cancel='+cancel;}
postData=encodeURI(postData);GetAndSet({url:'/ajax/hotelRooms?'+postData,successfunc:function(data){$('#hotelPriceBody').html(data);$('#hotelPriceBodyLoading').addClass('none');priceList.init();styleCtrl.hotelItemZIndex();},errorfunc:function(){}});},hotelPriceSearchEventBind:function(){$('#hotelPriceScanPrice').on('click',function(){var begin_date=$('#J_begin_date').val();var end_date=$('#J_end_date').val();var dateDif=Date.diff('D',begin_date,end_date);if(dateDif>=0&&dateDif<=28){priceList.getSection(true);}
$("#specialSort div").removeClass('on');$("#specialSort .cashBack .sort-cb-before-tab").removeClass('on');$("#specialSort .cashBack .sort-cb-after-tab").addClass('on');calendarWrap.linkage();});$('#specialSort #a,#specialSort #b,#specialSort #c, #specialSort #f').click(function(){var $this=$(this);$this.toggleClass('on');priceList.getSection();});$('#specialSort #d,#specialSort #e').click(function(){var id=this.id;var $this=$(this);if($this.hasClass('on')){return;}else{$this.addClass('on');if('d'==id){$('#specialSort #e').removeClass('on');$('.J_backBeforePrice').removeClass('none');$('.J_backAfterPrice').addClass('none');}
else{$('#specialSort #d').removeClass('on');$('.J_backBeforePrice').addClass('none');$('.J_backAfterPrice').removeClass('none');}
priceList.getSection();}});},hotelPriceEventBind:function(){var roomAmount=$('.J_hotelPriceList').length;for(var i=0;i<roomAmount;++i){$('#openHotelInfo'+i).on('click',function(e){_gaq.push(['_trackEvent','频道详情页','房型详情','查看详情']);var $this=$(this);var target=e.target||e.srcElement;if($(target).hasClass('detail')){var index=$(this).parents('.J_hotelPriceList').attr('data-index');if($('#hotelInfo'+index).hasClass('none')){$('#hotelInfo'+index).removeClass('none');$(target).text('< 收起');}
else{$('#hotelInfo'+index).addClass('none');$(target).text('查看详情 >');}
return;}
var index=$this.parents('.J_hotelPriceList').attr('data-index');if($('#hotelInfo'+index).hasClass('none')){$('#hotelInfo'+index).removeClass('none');$(this).find('.detail').text('< 收起');}
else{$('#hotelInfo'+index).addClass('none');$(this).find('.detail').text('查看详情 >');}});$('#closeHotelInfo'+i).on('click',function(e){var $this=$(this);var index=$this.parents('.J_hotelPriceList').attr('data-index');$('#hotelInfo'+index).addClass('none');$('#openHotelInfo'+index).find('.detail').text('查看详情 >');});$('#scanAllHotelInfo'+i).on('click',function(){_gaq.push(['_trackEvent','频道详情页','房型设施','查看设施']);var $this=$(this);var index=$this.parents('.J_hotelPriceList').attr('data-index');var allHotelInfoId=$('#allHotelInfo'+index);allHotelInfoId.toggleClass('none');if(allHotelInfoId.hasClass('none')){$('#scanAllHotelInfo'+index+' .fac_c2').removeClass('hotel_room_arrow_up').addClass('hotel_room_arrow_down');}else{$('#scanAllHotelInfo'+index+' .fac_c2').removeClass('hotel_room_arrow_down').addClass('hotel_room_arrow_up');}});$('#hotelRoomImage'+i).closest('div').on('mouseenter',function(){var $img=$(this).find('img');var id=$img.attr('id');var prefix='hotelRoomImage';var index=id.substr(prefix.length);var hintId='hotelRoomScanAll'+index;var $hint=$('#'+hintId);var $singleImg=$('#'+prefix+index);var len=$img.data('more').length;if(!!!len||len<=1){$singleImg.css('cursor','default');$hint.addClass('none');}else{$singleImg.css('cursor','pointer');$hint.removeClass('none');$hint.find('span').text(len);}}).on('mouseleave',function(){var $img=$(this).find('img');var id=$img.attr('id');var prefix='hotelRoomImage';var index=id.substr(prefix.length);var hintId='hotelRoomScanAll'+index;var $hint=$('#'+hintId);if(!$hint.hasClass('none')){$hint.addClass('none');}
var $singleImg=$('#'+prefix+index);$singleImg.css('cursor','default');});$('#hotelRoomImage'+i).on('click',function(e){var $this=$(this);var id=$this.attr('id');var prefix='hotelRoomImage';var index=id.substr(prefix.length);var $hotelRoomScanAll=$('#hotelRoomScanAll'+index);if(!$hotelRoomScanAll.hasClass('none')){$hotelRoomScanAll.trigger('click');}});$('#hotelRoomScanAll'+i).on('click',function(e){var $this=$(this);var id=$this.attr('id');var prefix='hotelRoomScanAll';var index=id.substr(prefix.length);var imgId='hotelRoomImage'+index;var $img=$('#'+imgId);var more=$img.data('more');var urls=[];_.each(more,function(e,i,l){urls[urls.length]=e.url;});stopPropagation(e);$('#mainLayout').removeClass('none');$('#hotelPhotoDialog').removeClass('none');var imgAmount=urls.length;generateOneRoomPhotos(urls);var imgWidth=$('.J_hgcWidth').width()||555;var width=imgWidth*imgAmount;$('#hotelPhotoSlide').css('width',width+'px');$('#hotelGalleryTabs span').css('display','none');var roomName=$this.parents('.s2').prev().find('.name').text();$('#hotelGalleryTabs span:eq(0)').css({'display':'inline-block','width':'200px','text-align':'left'}).removeClass('on').text(roomName+'('+imgAmount+')');$('#hotelGalleryTabs').off('click').css('pointer','default');});}
$('.hotelPic').ghost();},priceCalendas:function(){template.helper('stripYear',function(dateStr){var date,m,d;date=new Date(dateStr);m=date.getMonth()+1;d=date.getDate();if(m<10)m='0'+m;if(d<10)d='0'+d;return m+'-'+d;});var dayTextDict={0:'日',1:'一',2:'二',3:'三',4:'四',5:'五',6:'六'};Date.formatDateStr=function(dateStr,sep1,sep2){sep1=sep1||'-';sep2=sep2||'/';return dateStr.replace(new RegExp(sep1,'g'),sep2);};Date.prototype.getFormatDateStr=function(sep){var date,y,m,d;sep=sep||'/';date=this;y=date.getFullYear();m=date.getMonth()+1;d=date.getDate();if(m<10)m='0'+m;if(d<10)d='0'+d;return y+sep+m+sep+d;};Date.diff=function(interval,date1,date2){var objInterval={'D':1000*60*60*24,'H':1000*60*60,'M':1000*60,'S':1000,'T':1};interval=interval.toUpperCase();var dt1=Date.parse(date1.replace(/-/g,'/'));var dt2=Date.parse(date2.replace(/-/g,'/'));try{return Math.round((dt2-dt1)/eval('(objInterval.'+interval+')'));}catch(e){return e.message;}};var process=function(priceCalendar){var firstDay,dayLength;var priceDays=[];if(priceCalendar&&priceCalendar.length){_.forEach(priceCalendar,function(date){date.date=Date.formatDateStr(date.date);});firstDay=new Date(priceCalendar[0].date).getDay();dayLength=priceCalendar.length>7?7:priceCalendar.length;_.times(dayLength,function(i){var day=(firstDay+i)%7;priceDays.push(dayTextDict[day]);});}
return{priceDays:priceDays,priceCalendar:priceCalendar};};var render=template('price-calendar-template');var $el;var showPriceCalendar=function(e){var $currentTarget,$plan,planIndex,plan;var currentTarget=$(e.currentTarget);var priceCalendar=$.parseJSON(currentTarget.next().val());var vendorId=parseInt(currentTarget.attr('data-vendorId'));var hasTaxOrServiceFee=currentTarget.attr('data-hasTaxOrServiceFee');if(priceCalendar&&priceCalendar.length){if($("#specialSort #e").hasClass("on")){_.each(priceCalendar,function(e,i,l){var cashBack=e.cashBack||0;if(e.price>=0){if(e.price-cashBack>0){e.price=e.price-cashBack;}else{e.price=0;}}});}
var data=process(priceCalendar);var html=render(data);$el=$(html);$('body').append($el);pos(e.currentTarget,$el,vendorId,hasTaxOrServiceFee);}};var hidePriceCalendar=function(){$el&&$el.remove();};var pos=function(target,$el,vendorId,hasTaxOrServiceFee){var rect,rectWidth,rectHeight;rect=target.getBoundingClientRect();rectWidth=rect.right-rect.left;rectHeight=rect.bottom-rect.top;$el.css({left:rect.left+rectWidth/2-(26+6+36),top:rect.top+rectHeight+10,width:$el.find('.price-calendar').width()});if(vendorId==30258||hasTaxOrServiceFee){$el.find('.price-calendar-footer').show();var str='';if(vendorId==30258)str+='日均价做取整展示，实际支付以总价为准。';if(hasTaxOrServiceFee)str+='该价格包含税和服务费。';$el.find('.price-calendar-footer').text(str);}};$('.before_price').each(function(){$(this).on('mouseover','.price .digit',showPriceCalendar);$(this).on('mouseout','.price .digit',hidePriceCalendar);});$('.after_price').each(function(){$(this).on('mouseover','.price .digit',showPriceCalendar);$(this).on('mouseout','.price .digit',hidePriceCalendar);});},updateStartPrice:function(){var isFullRoom=$("input[name='isFullRoom']").val();var startPrice=$("input[name='startPrice']").val();var lowestPrice=$("input[name='lowestPrice']").val();if(isFullRoom){$("#J_hotelBrief .soldOut").siblings("div").hide();$("#J_hotelBrief .soldOut").show();}else if(startPrice>0){$("#J_hotelBrief .soldOut").siblings("div").show();$("#J_hotelBrief #startPrice").html(startPrice);}else{$("#J_hotelBrief .soldOut").siblings("div").show();$("#J_hotelBrief #startPrice").html(lowestPrice);}},filtersRender:function(){if($("#bedType_name").text()!='床型'){$("#bedType_name").parent('.Style_title').addClass('Style_title_add');$("#bedType_name").parent('.Style_title').addClass('Style_title_mark');$("#bedType_name").siblings('.Style_icon').addClass('Style_icon_add');}
if($("#breakfast_name").text()!='早餐'){$("#breakfast_name").parent('.Style_title').addClass('Style_title_add');$("#breakfast_name").parent('.Style_title').addClass('Style_title_mark');$("#breakfast_name").siblings('.Style_icon').addClass('Style_icon_add');}
if($("#network_name").text()!='宽带'){$("#network_name").parent('.Style_title').addClass('Style_title_add');$("#network_name").parent('.Style_title').addClass('Style_title_mark');$("#network_name").siblings('.Style_icon').addClass('Style_icon_add');}
if($("#cancel_name").text()!='取消政策'){$("#cancel_name").parent('.Style_title').addClass('Style_title_add');$("#cancel_name").parent('.Style_title').addClass('Style_title_mark');$("#cancel_name").siblings('.Style_icon').addClass('Style_icon_add');}
var back_filters=$.parseJSON($("input[name='back_filters']").val());if(back_filters){if(back_filters.instantConfirm){$("#specialSort .instant-confirmation").show();}else{$("#specialSort .instant-confirmation").hide();}
if(back_filters.promoting){$("#specialSort .promotion").show();}else{$("#specialSort .promotion").hide();}
if(back_filters.hourRoom){$("#specialSort .hour-room").show();}else{$("#specialSort .hour-room").hide();}
if(back_filters.prePay){$("#specialSort .prePay").show();}else{$("#specialSort .prePay").hide();}
if(back_filters.hasCash){$("#specialSort .cashBack").show();}else{$("#specialSort .cashBack").hide();}}else{$("#specialSort div").hide();$("#specialSort .sort-tab").removeClass('on');$("#specialSort .cashBack .sort-cb-before-tab").removeClass('on');$("#specialSort .cashBack .sort-cb-after-tab").addClass('on');}}};var userComment={init:function(){this.userCommentEventBind();},userCommentEventBind:function(){}};$('#environmentTab').on('click',function(e){var $this=$(this);var e=e||window.event;var target=e.srcElement||e.target;var $target=$(target);var oldId=null;var tagName=($target.context.tagName).toUpperCase();if('EM'==tagName){$target=$target.parents('SPAN');tagName='SPAN';}
if(tagName==='SPAN'){var oldObj=$this.find('.sel_cur');oldObj.removeClass('sel_cur');oldId=oldObj.attr('id');$target.addClass('sel_cur');var clickedId=$target.context.id||$target.attr('id');if(oldId==clickedId){return;}else{hotelPhotoLoadInit(clickedId,1);photoPaginationInit();}}
else{}});$('#trafficTab').on('click',function(e){var $this=$(this);var e=e||window.event;var target=e.srcElement||e.target;var $target=$(target);var tagName=($target.context.tagName).toUpperCase();if(tagName==='LI'){$target=$target.find('SPAN');}else if(tagName==='UL'){return;}
var clickedId=$target.attr('id');var $oldNode=$this.find('.sel_cur');var oldNodeId=$oldNode.attr('id');if(clickedId==oldNodeId){return;}
$oldNode.removeClass('sel_cur');$target.addClass('sel_cur');$('.J_roomLists').find('div[id="'+oldNodeId+'"]').addClass('none');$('.J_roomLists').find('div[id="'+clickedId+'"]').removeClass('none');});$('#startOrder').click(function(){$(window).scrollTop(500);});$('#hotelScore').click(function(){var top=$('#hotelUserComment').offset().top;$(window).scrollTop(top);});$('#details').click(function(e){var $this=$(this);var e=e||window.event;var target=e.srcElement||e.target;var $target=$(target);var tagName=($target.context.tagName).toUpperCase();if(tagName==='SPAN'||'STRONG'===tagName){$this.find('.cur').removeClass('cur');var $li=$target.parents('li');var id=parseInt($li.attr('id'),10);var ids=['hotelPrice','hotelIntroduction','hotelUserComment','hotelEnvironment','hotelTraffic'];var startBookId=5;if(id!=startBookId){$li.addClass('cur');var top=$('#'+ids[id]).offset().top;}else{$('#mainTab li:eq(0)').addClass('cur');var top=$('#'+ids[0]).offset().top;}
if(0==id||startBookId==id){top=top-$('#details').height();}
$(window).scrollTop(top);}
else{}});function ajaxDataInit(){var hotelId=$("#hotelId").val();var productId=$("#hotel_product_id").val();ajaxData_g.hotelId=hotelId;ajaxData_g.productId=productId;};ajaxDataInit();$(window).scroll(function(){var pos=$('#details').css('position');if(pos!='fixed'){top_g=$('#details').offset().top;}
var scrollTop=$(window).scrollTop();if(scrollTop>top_g){var detailsWidth;if(document.documentElement.clientWidth>=1200){detailsWidth='938px';}else{detailsWidth='983px';}
$('#details').css({position:'fixed',top:0,'z-index':1000,'width':detailsWidth});}else{$('#details').css({position:'relative'});}
var hotelPriceTop;if($('#hotelPrice').length){hotelPriceTop=$('#hotelPrice').offset().top;}
var hotelIntroductionTop=$('#hotelIntroduction').offset().top;var hotelUserCommentTop=$('#hotelUserComment').offset().top;var hotelEnvironmentTop=$('#hotelEnvironment').offset().top;var hotelTrafficTop=$('#hotelTraffic').offset().top;var curIndex=-1;var deviation=20;var ifRemoveCur=true;if(hotelPriceTop&&scrollTop<=hotelPriceTop){curIndex=0;}else if(scrollTop>hotelIntroductionTop+deviation&&scrollTop<=hotelUserCommentTop-deviation){curIndex=1;}else if(scrollTop>hotelUserCommentTop+deviation&&scrollTop<=hotelEnvironmentTop-deviation){curIndex=2;}else if(scrollTop>hotelEnvironmentTop+deviation&&scrollTop<=hotelTrafficTop-deviation){curIndex=3;}else if(scrollTop>hotelTrafficTop+deviation){curIndex=4;}else{ifRemoveCur=false;}
if(ifRemoveCur){$('#mainTab').find('.cur').removeClass('cur');$('#mainTab li:eq('+curIndex+')').addClass('cur');}});function hotelPhotoHeaderInit(){var amount={'appearance':0,'indoorScene':0,'room':0};var allAmount=allPhotos_g.length;_.each(allPhotos_g,function(e,i,l){amount[e.groupEn]+=1;});$('#environmentTab #all em').text(allAmount);if(0===amount.appearance){$('#environmentTab #appearance').parent().remove();}else{$('#environmentTab #appearance em').text(amount.appearance);}
_.each(amount,function(v,k,l){if(0===v){$('#environmentTab #'+k).parent().remove();}else{$('#environmentTab #'+k+' em').text(v);}})}
function photoPaginationInit(){var photoNum=$('#environmentTab .sel_cur em').text();photoNum=parseInt(photoNum,10);var $imagesPage=$('#imagesPage').parent();if(photoNum<=photoNumPerPage_g){$imagesPage.addClass('none');}else{$imagesPage.removeClass('none');var pageAmount=Math.ceil(photoNum/photoNumPerPage_g);PhotoPagesObj.pageAmount=pageAmount;PhotoPagesObj.imagesPage(1,pageAmount);}}
function firtPageImagesLoad(data){var main=data;var mainHtml='';var hotelName=$('#hotelName').text();_.each(main,function(e,i,l){var node='<div class="slide">';node+='<img src="'+e.big+'" alt="'+hotelName+'" data-type="'+e.groupEn+'"/>';node+='</div>';mainHtml+=node;});var $hotelImagesSlide=$('#hotelImagesSlide');$hotelImagesSlide.empty().append(mainHtml);var imgNum=main.length;if(0===imgNum||1===imgNum){$('#hotelImagesPrevBtn').addClass('none');$('#hotelImagesNextBtn').addClass('none');}
if(0===imgNum){$('.J_hotelNone').removeClass('none');$('.J_hotelImages').addClass('none');}else{$('#imgAmount em').replaceWith('<em>'+imgNum+'</em>');var imgWidth=$('.J_Width').width()||450;var width=imgWidth*imgNum;$('#hotelImagesSlide').css({width:width+'px',left:0});$('.J_hotelNone').addClass('none');$('.J_hotelImages').removeClass('none');}}
$('#hotelImagesPrevBtn').click(function(e){stopPropagation(e);var left=$('#hotelImagesSlide').position().left;var imgWidth=$('.J_Width').width()||450;var len=$('#hotelImagesSlide img').length;var leftEnd=0;if(0==left)
{leftEnd=imgWidth*(len-1)*(-1);}else{leftEnd=left+imgWidth;}
$('#hotelImagesSlide').css('left',leftEnd+'px');});$('#hotelImagesNextBtn').click(function(e){stopPropagation(e);var left=$('#hotelImagesSlide').position().left;var len=$('#hotelImagesSlide img').length;var imgWidth=$('.J_Width').width()||450;if(left==(len-1)*imgWidth*(-1)){$('#hotelImagesSlide').css('left',0);}else{var leftEnd=left-imgWidth;$('#hotelImagesSlide').css('left',leftEnd+'px');}});function generatePhotoSlideAndPanel(type){var $hotelPhotoSlide=$('#hotelPhotoSlide');$hotelPhotoSlide.empty();var hotelPhotoSlideHtml='';var $hotelGalleryPanel=$('#hotelGalleryPanel');$hotelGalleryPanel.empty();var hotelGalleryPanelHtml='';var imgs=imgObj_g[type];var src='';var len=imgs.length;var hotelName=$('#hotelName').text()+'图片';if(0==len||1==len){$('#hotelPhotoPrev').addClass('none');$('#hotelPhotoNext').addClass('none');}else{$('#hotelPhotoPrev').removeClass('none');$('#hotelPhotoNext').removeClass('none');}
for(var i=0;i<len;++i){src=imgs[i];hotelPhotoSlideHtml+='<div class="slide"><img src="'+src+'" alt="'+hotelName+'" data-index='+i+' /></div>';hotelGalleryPanelHtml+='<a class="hotel-gallery-pic" data-index="'+i+'"  href="javascript:void(0);"><img src="'+src+'" alt="'+hotelName+'" /></a>';}
$hotelPhotoSlide.append(hotelPhotoSlideHtml);$hotelGalleryPanel.append(hotelGalleryPanelHtml);$hotelPhotoSlide.css('left',0);$hotelGalleryPanel.find('a:eq(0)').addClass('current');};function generateOneRoomPhotos(urls){var $hotelPhotoSlide=$('#hotelPhotoSlide');$hotelPhotoSlide.empty();var hotelPhotoSlideHtml='';var $hotelGalleryPanel=$('#hotelGalleryPanel');$hotelGalleryPanel.empty();var hotelGalleryPanelHtml='';var src='';var len=urls.length;var hotelName=$('#hotelName').text()+'图片';if(0==len||1==len){$('#hotelPhotoPrev').addClass('none');$('#hotelPhotoNext').addClass('none');}else{$('#hotelPhotoPrev').removeClass('none');$('#hotelPhotoNext').removeClass('none');}
for(var i=0;i<len;++i){src=urls[i];hotelPhotoSlideHtml+='<div class="slide"><img src="'+src+'" alt="'+hotelName+'" data-index='+i+' /></div>';hotelGalleryPanelHtml+='<a class="hotel-gallery-pic" data-index="'+i+'"  href="javascript:void(0);"><img src="'+src+'" alt="'+hotelName+'" /></a>';}
$hotelPhotoSlide.append(hotelPhotoSlideHtml);$hotelGalleryPanel.append(hotelGalleryPanelHtml);$hotelPhotoSlide.css('left',0);$hotelGalleryPanel.find('a:eq(0)').addClass('current');};$('#imgAmount').click(function(e){hotelGalleryTabsClickOn();stopPropagation(e);$('#hotelGalleryTabs span').css('display','inline-block');var $firstTabHead=$('#hotelGalleryTabs span:eq(0)');$firstTabHead.css({'width':'60px','text-align':'center'}).html('所有(<em></em>)');if(!$firstTabHead.hasClass('on')){$firstTabHead.addClass('on');}
$('#mainLayout').removeClass('none');$('#hotelPhotoDialog').removeClass('none');var imgAmount=$('#hotelImagesSlide img').length;var imgObj={'all':[],'appearance':[],'indoorScene':[],'room':[],'other':[]};for(var i=0;i<imgAmount;++i){var $singleImg=$('#hotelImagesSlide img:eq('+i+')');var src=$singleImg.attr('src');var type=$singleImg.attr('data-type');var all=imgObj['all'];all[all.length]=src;var arr=imgObj[type];arr[arr.length]=src;}
imgObj_g=imgObj;generatePhotoSlideAndPanel('all');var imgWidth=$('.J_hgcWidth').width()||555;var width=imgWidth*imgAmount;$('#hotelPhotoSlide').css('width',width+'px');$('#hotelGalleryTabs span:eq(0) em').text(imgObj['all'].length);var index=1;_.each(imgObj,function(v,k,l){if(2===index||3===index||4===index){if(0===v.length){var $tmpSpan=$('#hotelGalleryTabs span[data-tab-type="'+k+'"]');$tmpSpan.prev('span').remove();$tmpSpan.remove();}else{$('#hotelGalleryTabs span[data-tab-type="'+k+'"] em').text(v.length);}}
index+=1;})});$('.J_Width').on('click',function(){$('#imgAmount').click();})
$('.J_hotelImages .a2,.J_hotelImages .a3,.J_hotelImages .a4,.J_hotelImages .a5,.J_hotelImages .a6').on('click',function(){$('#imgAmount').click();});$('.J_hotelImages .a2 .hotelPic,.J_hotelImages .a3 .hotelPic,.J_hotelImages .a4 .hotelPic,.J_hotelImages .a5 .hotelPic,.J_hotelImages .a6 .hotelPic').ghost();$('#closeHotelPhotoDialog').click(function(){$('#mainLayout').addClass('none');$('#hotelPhotoDialog').addClass('none');});var hotelGalleryTabsClickOn=function(){$('#hotelGalleryTabs').css('cursor','pointer');$('#hotelGalleryTabs').on('click',function(e){var e=e||window.event;var target=e.srcElement||e.target;var $target=$(target);var tagName=($target.context.tagName).toUpperCase();var $SPAN=null;if('SPAN'==tagName){$SPAN=$target;}else if('EM'==tagName){$SPAN=$target.parent('SPAN');}
var hotelType=$SPAN.attr('data-tab-type');if(!!!hotelType){return;}
var $this=$(this);$this.find('.on').removeClass('on');$SPAN.addClass('on');generatePhotoSlideAndPanel(hotelType);});};hotelGalleryTabsClickOn();function GalleryPanelScrollCtrl($curNode){var panelTop=$('#hotelGalleryPanel').scrollTop();var $hotelGalleryPic=$('.hotel-gallery-panel .hotel-gallery-pic');var currentTop=parseInt($curNode.position().top,10);var marginTopTmp=$hotelGalleryPic.css('margin-top');var marginTop=parseInt(marginTopTmp.substr(0,marginTopTmp.length-2),10);var picHeight=parseInt($hotelGalleryPic.height(),10);var panelHeight=parseInt($('#hotelGalleryPanel').height());var currentHeight=currentTop+marginTop+picHeight;if(currentHeight>panelHeight){$('#hotelGalleryPanel').scrollTop(panelTop+200);}else if(currentTop<0){$('#hotelGalleryPanel').scrollTop(panelTop-200);}};$('#hotelPhotoPrev').click(function(){var $hotelPhotoSlide=$('#hotelPhotoSlide');var left=$hotelPhotoSlide.position().left;var len=$('#hotelPhotoSlide img').length;var imgWidth=$('.J_hgcWidth').width()||555;var leftEnd=null;if(left==0){leftEnd=(len-1)*(-1)*imgWidth;}else{leftEnd=left+imgWidth;}
$hotelPhotoSlide.css('left',leftEnd+'px');var imgIndex=leftEnd*(-1)/imgWidth;$('#hotelGalleryPanel').find('.current').removeClass('current').end().find('a:eq('+imgIndex+')').addClass('current');GalleryPanelScrollCtrl($('.hotel-gallery-panel .hotel-gallery-pic.current'));});$('#hotelPhotoNext').click(function(){var $hotelPhotoSlide=$('#hotelPhotoSlide');var left=$hotelPhotoSlide.position().left;var len=$('#hotelPhotoSlide img').length;var imgWidth=$('.J_hgcWidth').width()||555;var leftEnd=0;if(left==(len-1)*imgWidth*(-1)){leftEnd=0;}else{leftEnd=left-imgWidth;}
$hotelPhotoSlide.css('left',leftEnd+'px');var imgIndex=leftEnd*(-1)/imgWidth;$('#hotelGalleryPanel').find('.current').removeClass('current').end().find('a:eq('+imgIndex+')').addClass('current');GalleryPanelScrollCtrl($('.hotel-gallery-panel .hotel-gallery-pic.current'));});$('#hotelGalleryPanel').on('click',function(e){var e=e||window.event;var target=e.srcElement||e.target;var $target=$(target);var tagName=($target.context.tagName).toUpperCase();if(tagName=='IMG'){$target=$target.parent();}
var $this=$(this);var imgIndex=$target.attr('data-index');var $oldNode=$this.find('.current');var curIndex=$oldNode.attr('data-index');if(imgIndex==curIndex){return;}else{$oldNode.removeClass('current');var $curNode=$this.find('a:eq('+imgIndex+')');$curNode.addClass('current');var imgWidth=$('.J_hgcWidth').width()||555;var left=imgWidth*(-1)*imgIndex;$('#hotelPhotoSlide').css('left',left);}
GalleryPanelScrollCtrl($('.hotel-gallery-panel .hotel-gallery-pic.current'));});function convertToBMap(a,b){var c=52.35987755982988,d=b,e=a,f=Math.sqrt(d*d+e*e)+2e-5*Math.sin(e*c),g=Math.atan2(e,d)+3e-6*Math.cos(d*c),h=f*Math.cos(g)+.0065,i=f*Math.sin(g)+.006;return{lng:h,lat:i}};function transformLat(x,y){var pi=3.14159265358979324;var ret=-100.0+2.0*x+3.0*y+0.2*y*y+0.1*x*y+0.2*Math.sqrt(Math.abs(x));ret+=(20.0*Math.sin(6.0*x*pi)+20.0*Math.sin(2.0*x*pi))*2.0/3.0;ret+=(20.0*Math.sin(y*pi)+40.0*Math.sin(y/3.0*pi))*2.0/3.0;ret+=(160.0*Math.sin(y/12.0*pi)+320*Math.sin(y*pi/30.0))*2.0/3.0;return ret;}
function transformLon(x,y){var pi=3.14159265358979324;var ret=300.0+x+2.0*y+0.1*x*x+0.1*x*y+0.1*Math.sqrt(Math.abs(x));ret+=(20.0*Math.sin(6.0*x*pi)+20.0*Math.sin(2.0*x*pi))*2.0/3.0;ret+=(20.0*Math.sin(x*pi)+40.0*Math.sin(x/3.0*pi))*2.0/3.0;ret+=(150.0*Math.sin(x/12.0*pi)+300.0*Math.sin(x/30.0*pi))*2.0/3.0;return ret;}
function getMarsCoordinate(lat,lon){var pi=3.14159265358979324;var ee=0.00669342162296594323;var a=6378245.0;var temp_lat=transformLat(lon-105.0,lat-35.0);var temp_lon=transformLon(lon-105.0,lat-35.0);var rad_lat=lat/180*pi;var magic=Math.sin(rad_lat);magic=1-ee*magic*magic;var sqrtMagic=Math.sqrt(magic);temp_lat=(temp_lat*180.0)/((a*(1-ee))/(magic*sqrtMagic)*pi);temp_lon=(temp_lon*180.0)/(a/sqrtMagic*Math.cos(rad_lat)*pi);return{lng:temp_lon+lon,lat:temp_lat+lat};}
(function generateMap(){var map=new BMap.Map("hotelSideMap");var changeMap=convertToBMap($("#latitude").val(),$("#longitude").val());if(parseInt($('#province_code').val())==2900){changeMap=getMarsCoordinate(changeMap.lat,changeMap.lng);}
var point=new BMap.Point(changeMap.lng,changeMap.lat);map.centerAndZoom(point,15);var marker=new BMap.Marker(point);map.addOverlay(marker);var top_left_control=new BMap.ScaleControl({anchor:BMAP_ANCHOR_TOP_LEFT});var top_left_navigation=new BMap.NavigationControl();map.addControl(top_left_control);map.addControl(top_left_navigation);})();(function right_roll(){$('.onlineService').click(function(){var productType=6;var title=$('#htmlTitle').val();var param={'entranceUrl':window.location.host+window.location.pathname,'title':title,'productId':$("#hId").val(),'productType':productType};ChatEntry.openChat('product',productType,param);});})();$(document).delegate('.J-list ul li','click',function(){$(this).parents('.J-list').hide();$(this).parents('.filterStyle').find('.Style_name').attr('data',($(this).attr('data')));priceList.getSection();});$(document).delegate('.J-list ul li','hover',function(){if($(this).index()!=0){$(this).parent().find('li:eq(0)').removeClass('Style_list_li_hover');$(this).toggleClass('Style_list_li_hover');}
else{if(!$(this).hasClass('Style_list_li_hover')){$(this).addClass('Style_list_li_hover');}}});$(document).delegate('.filterStyle','hover',function(){if($(this).find('.Style_title').hasClass('Style_title_mark')){$(this).find('.Style_title').toggleClass('Style_title_add');$(this).find('.Style_icon').toggleClass('Style_icon_add');}
var $list=$(this).find('.J-list');$list.find('li:eq(0)').addClass('Style_list_li_hover');$list.css('left',$(this).find('.J-btn').width()-$list.width());$(this).find('.J-btn').toggleClass('J-bnt-add');$list.toggle();});$('.comment_pic').ghost();$(".rollpicshow").each(function(){var length=$(this).children().children().length;$(this).jCarouselLite({btnNext:"#"+$(this).prev().attr('id'),btnPrev:"#"+$(this).next().attr('id'),visible:length>6?6:length});});});;$(function(){var detailMonitor={init:function(){this.bindEvent.search();this.bindEvent.onlineService();this.bindEvent.advise();this.bindEvent.helpCenter();this.bindEvent.gotoTop();this.bindEvent.history();this.bindEvent.nearby();this.bindEvent.hotelImg();this.bindEvent.hotelPic();this.bindEvent.startOrder();this.bindEvent.dateChange();this.bindEvent.viewComments();this.bindEvent.commentConclude();this.bindEvent.cashBackBefore();this.bindEvent.cashBackAfter();this.bindEvent.hourRoom();this.bindEvent.promotion();this.bindEvent.instantConfirm();this.bindEvent.prePay();this.bindEvent.viewBtn();this.bindEvent.mainTab();this.bindEvent.traffic();this.bindEvent.viewMap();},_gaq:_gaq||[],param:{category:'国内酒店频道详情页',action:'',key:'',value:''},cleanCityName:function(c){var pattern=new RegExp("^[\u4E00-\u9FA5]+$");var cs=c.split('');var rt=[];for(var i in cs){if(pattern.test(cs[i])){rt.push(cs[i]);}}
return rt.join('');},cleanParams:function(s){return s.replace("'","").replace('"','').replace("<","").replace(">","").replace("/","").replace(";","").replace("@","").replace("%","").replace("*","").replace("&","");},trackEvent:function(){this._gaq.push(['_trackEvent',this.param.category,this.param.action,this.param.key]);},bindEvent:{search:function(){$('#search_hotel').click(function(){detailMonitor.param.action='酒店搜索';detailMonitor.param.key='查看其它酒店';detailMonitor.trackEvent();var cityName=detailMonitor.cleanCityName($('#txtCity').val()),keyWord=detailMonitor.cleanParams($('#keyWord').val()),checkindate=$('#begin_date').val(),checkoutdate=$('#end_date').val();detailMonitor.param.action='选择城市';detailMonitor.param.key=cityName;detailMonitor.trackEvent();detailMonitor.param.action='团期选择';detailMonitor.param.key='checkindate='+checkindate+'&checkoutdate='+checkoutdate;detailMonitor.trackEvent();if(keyWord){detailMonitor.param.action='关键字';detailMonitor.param.key=keyWord;detailMonitor.trackEvent();}});},onlineService:function(){$('#right_scroll').on('click','.kefu-li',function(){detailMonitor.param.action='右边栏';detailMonitor.param.key='在线客服';detailMonitor.trackEvent();});},advise:function(){$('#right_scroll').on('click','.fankui-li',function(){detailMonitor.param.action='右边栏';detailMonitor.param.key='意见反馈';detailMonitor.trackEvent();});},helpCenter:function(){$('#right_scroll').on('click','.ques-li',function(){detailMonitor.param.action='右边栏';detailMonitor.param.key='帮助中心';detailMonitor.trackEvent();});},gotoTop:function(){$('#right_scroll').on('click','.toTop',function(){detailMonitor.param.action='右边栏';detailMonitor.param.key='返回顶部';detailMonitor.trackEvent();});},history:function(){$('.hl_most_distance a').click(function(){detailMonitor.param.action='浏览历史';detailMonitor.param.key=$(this).attr('title');detailMonitor.trackEvent();});},nearby:function(){$('.hl_nearby a').click(function(){detailMonitor.param.action='附近酒店';detailMonitor.param.key=$(this).attr('title');detailMonitor.trackEvent();});},hotelImg:function(){$('#hotelImagesSlide img').click(function(){detailMonitor.param.action='酒店图片';detailMonitor.param.key='查看图片';detailMonitor.trackEvent();});},hotelPic:function(){$('.J_hotelImages .hotelPic').click(function(){detailMonitor.param.action='酒店图片';detailMonitor.param.key='查看图片';detailMonitor.trackEvent();});},startOrder:function(){$('#startOrder').click(function(){detailMonitor.param.action='顶部预订';detailMonitor.param.key='开始预订';detailMonitor.trackEvent();});},dateChange:function(){$('#hotelPriceScanPrice').click(function(){detailMonitor.param.action='团期修改';detailMonitor.param.key='确定按钮';detailMonitor.trackEvent();});},viewComments:function(){$('#hotelScore').click(function(){detailMonitor.param.action='顶部点评';detailMonitor.param.key='查看点评';detailMonitor.trackEvent();});},commentConclude:function(){$('.tradeoffConclude a').click(function(){var type=$(this).attr('data');switch(parseInt(type)){case 1:type='满意';break;case 2:type='一般';break;case 3:type='不满意';break;case 4:type='有图';break;default:type='全部';break;}
detailMonitor.param.action='点评';detailMonitor.param.key=type;detailMonitor.trackEvent();});},cashBackBefore:function(){$('#d').click(function(){detailMonitor.param.action='筛选';detailMonitor.param.key='返前价';detailMonitor.trackEvent();});},cashBackAfter:function(){$('#e').click(function(){detailMonitor.param.action='筛选';detailMonitor.param.key='返后价';detailMonitor.trackEvent();});},hourRoom:function(){$('#c').click(function(){detailMonitor.param.action='筛选';detailMonitor.param.key='钟点房';detailMonitor.trackEvent();});},promotion:function(){$('#b').click(function(){detailMonitor.param.action='筛选';detailMonitor.param.key='促销';detailMonitor.trackEvent();});},instantConfirm:function(){$('#a').click(function(){detailMonitor.param.action='筛选';detailMonitor.param.key='立即确认';detailMonitor.trackEvent();});},prePay:function(){$('#f').click(function(){detailMonitor.param.action='筛选';detailMonitor.param.key='可预付';detailMonitor.trackEvent();});},viewBtn:function(){$('#hotelPriceBody').on('mouseover','.scan',function(){detailMonitor.param.action='预定限制';detailMonitor.param.key='查看按钮';detailMonitor.trackEvent();});},mainTab:function(){$('#mainTab').on('click','ul li',function(){var type=$(this).attr('id');switch(parseInt(type)){case 0:type='查看房型';break;case 1:type='查看介绍';break;case 2:type='查看点评';break;case 3:type='查看图片';break;case 4:type='查看交通';break;case 5:type='开始预订';break;default:return false;}
detailMonitor.param.action='详情tab';detailMonitor.param.key=type;detailMonitor.trackEvent();});},traffic:function(){$('#trafficTab li').click(function(){detailMonitor.param.action='酒店周边';detailMonitor.param.key=$(this).children().text();detailMonitor.trackEvent();});},viewMap:function(){$('.search_hotel_map').click(function(){detailMonitor.param.action='地图';detailMonitor.param.key='查看地图';detailMonitor.trackEvent();});},},};try{detailMonitor.init();}catch(e){detailMonitor.param.action='JS出错';detailMonitor.param.key=e.message;detailMonitor.trackEvent();}});